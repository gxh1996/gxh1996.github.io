window.__require=function t(e,o,i){function r(s,a){if(!o[s]){if(!e[s]){var c=s.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+s+"'")}}var u=o[s]={exports:{}};e[s][0].call(u.exports,function(t){return r(e[s][1][t]||t)},u,u.exports,t,e,o,i)}return o[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<i.length;s++)r(i[s]);return r}({V_gameState:[function(t,e,o){"use strict";cc._RF.push(e,"2923afG7tNMVZBvUd6/RnLm","V_gameState");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,a=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hp=null,e.gold=null,e.round=null,e}return i(e,t),e.prototype.setHP=function(t){this.hp.string=t.toString()},e.prototype.setGold=function(t){this.gold.string=t.toString()},e.prototype.setRound=function(t,e){this.round.string=t+"/"+e},r([a({type:cc.Label})],e.prototype,"hp",void 0),r([a({type:cc.Label})],e.prototype,"gold",void 0),r([a({type:cc.Label})],e.prototype,"round",void 0),e=r([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],aSeriesSkill:[function(t,e,o){"use strict";cc._RF.push(e,"76113tXtdFKfauIznqEqSv3","aSeriesSkill");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n,s=t("../common/module/gameDataManager"),a=cc._decorator,c=a.ccclass,l=a.property;(function(t){t[t.Upgradable=0]="Upgradable",t[t.StarShort=1]="StarShort",t[t.Upgraded=2]="Upgraded",t[t.UnUpgrade=3]="UnUpgrade"})(n=o.SkillState||(o.SkillState={}));var u=function(){function t(t,e,o){this.node=t,this.button=t.getChildByName("bg").getComponent(cc.Button),this.starNum=t.getChildByName("starNum"),this.labelNode=this.starNum.getChildByName("label"),this.label=this.labelNode.getComponent(cc.Label),this.setState(e),this.setNeedStarNum(o)}return t.prototype.setState=function(t){switch(this.state=t,this.state){case n.Upgradable:this.button.interactable=!0,this.starNum.active=!0,this.labelNode.color=cc.Color.WHITE;break;case n.StarShort:this.button.interactable=!0,this.starNum.active=!0,this.labelNode.color=cc.Color.RED;break;case n.UnUpgrade:this.button.interactable=!1,this.starNum.active=!0,this.labelNode.color=cc.Color.WHITE;break;case n.Upgraded:this.button.interactable=!0,this.starNum.active=!1,this.labelNode.color=cc.Color.WHITE}},t.prototype.getState=function(){return this.state},t.prototype.getButton=function(){return this.button},t.prototype.setNeedStarNum=function(t){this.label.string=t.toString()},t}();o.SkillIcon=u;var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skillNum=1,e.skillNode=null,e.skillIcons=[],e.gameConfig=null,e.user=null,e.skillLevel=null,e.selectLevelScene=null,e.skillsBoard=null,e}return i(e,t),e.prototype.onLoad=function(){this.gameConfig=s.default.getGameConfig(),this.user=s.default.getCurrentUser(),this.skillLevel=this.user.getSkillsLevel(),this.skillNode=this.node.children,this.selectLevelScene=cc.find("Canvas").getComponent("selectLevelScene"),this.skillsUpNeedStar=this.gameConfig.getSkillsUpNeedStar(),this.skillsBoard=cc.find("Canvas/centerAnchor/skillsBoard").getComponent("skillsBoard")},e.prototype.start=function(){this.initskillIcons()},e.prototype.initskillIcons=function(){for(var t=0;t<5;t++){var e=new u(this.skillNode[t],this.judgeSkillState(t+1),this.skillsUpNeedStar[this.skillNum-1][t]);this.skillIcons.push(e);var o=e.getButton(),i=new cc.Component.EventHandler;i.target=this.node,i.component="aSeriesSkill",i.handler="upSkill",i.customEventData=t.toString(),o.clickEvents.push(i)}},e.prototype.updateSkillIcons=function(){for(var t=0;t<this.skillIcons.length;t++)this.skillIcons[t].setState(this.judgeSkillState(t+1))},e.prototype.upSkill=function(t,e){if(!((e=Number(e))<=this.skillLevel[this.skillNum-1])){var o=this.skillsUpNeedStar[this.skillNum-1][e-1];o>this.user.getCurrentHaveStarNum()||(this.user.subHavedStar(o),this.skillLevel[this.skillNum-1]=e,this.skillIcons[e-1].setState(n.Upgraded),this.skillIcons[e].setState(this.judgeSkillState(e+1)),this.selectLevelScene.updateScoreLabel(),this.skillsBoard.updateStarNum())}},e.prototype.judgeSkillState=function(t){if(t<=this.skillLevel[this.skillNum-1])return n.Upgraded;if(t===this.skillLevel[this.skillNum-1]+1){var e=this.skillsUpNeedStar[this.skillNum-1][t-1];return this.user.getCurrentHaveStarNum()>=e?n.Upgradable:n.StarShort}return n.UnUpgrade},r([l({tooltip:"\u8fd9\u4e2a\u662f\u7b2c\u51e0\u4e2a\u6280\u80fd\uff0c\u4ece1\u5f00\u59cb"})],e.prototype,"skillNum",void 0),e=r([c],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../common/module/gameDataManager":"gameDataManager"}],aboutScene:[function(t,e,o){"use strict";cc._RF.push(e,"f79d4kxUTVLgpxuoorvd4d9","aboutScene");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/gameDataManager"),s=t("../../res/prefabs/loadingDoorAnim/loadingDoorAnim"),a=t("../common/module/soundsManager"),c=cc._decorator,l=c.ccclass,u=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingDoorAnim=null,e.isBackButton=!1,e}return i(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){this.loadingDoorAnim.setState(!1),this.loadingDoorAnim.openDoor()},e.prototype.backButton=function(){if(!this.isBackButton){this.isBackButton=!0,a.default.ins.playEffect("sounds/click");var t=cc.callFunc(function(){cc.director.loadScene("homeScene",function(){var t=cc.find("Canvas/centerAnchor/loadingDoorAnim").getComponent("loadingDoorAnim");t.setState(!1),t.openDoor()})},this);this.loadingDoorAnim.closeDoor(t),n.default.preserveGameData()}},r([u({type:s.default})],e.prototype,"loadingDoorAnim",void 0),e=r([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../res/prefabs/loadingDoorAnim/loadingDoorAnim":"loadingDoorAnim","../common/module/gameDataManager":"gameDataManager","../common/module/soundsManager":"soundsManager"}],animationPath:[function(t,e,o){"use strict";cc._RF.push(e,"06f6d0vxPFBFYgusIPYpJNx","animationPath");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,a=(n.property,function(){function t(t,e,o,i){this.posArray=[],this.lenght=null,this.startPos=t,this.cPos1=e,this.cPos2=o,this.endPos=i,this.lenght=this.getBezierLen()}return t.prototype.createPosArray=function(t){for(var e=Math.floor(this.lenght/t),o=1/e,i=o;i<=1;i+=o){var r=this.bezier(this.startPos.x,this.cPos1.x,this.cPos2.x,this.endPos.x,i),n=this.bezier(this.startPos.y,this.cPos1.y,this.cPos2.y,this.endPos.y,i);this.posArray.push(cc.v2(r,n))}this.posArray.length<e&&this.posArray.push(this.endPos)},t.prototype.getBezierLen=function(t){void 0===t&&(t=20);var e,o,i=0,r=cc.v2(0,0);for(e=0;e<=1;e+=.05){var n=this.bezier(this.startPos.x,this.cPos1.x,this.cPos2.x,this.endPos.x,e),s=this.bezier(this.startPos.y,this.cPos1.y,this.cPos2.y,this.endPos.y,e);i+=(o=cc.v2(n,s)).sub(r).mag(),r=o}return i},t.prototype.bezier=function(t,e,o,i,r){return t*Math.pow(1-r,3)+3*e*r*Math.pow(1-r,2)+3*o*r*r*(1-r)+i*Math.pow(r,3)},t}());o.BezierPart=a;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animation=null,e.griphics=null,e}return i(e,t),e.prototype.onLoad=function(){this.animation=this.node.getComponent(cc.Animation)},e.prototype.start=function(){},e.prototype.getWorldPath=function(t){for(var e=this.getNodePath(t),o=0;o<e.length;o++)e[o]=this.node.convertToWorldSpaceAR(e[o]);return e},e.prototype.getNodePath=function(t){var e=this.animation.getClips()[0].curveData.paths[t].props.position,o=this.getBezierPartArray(e);return this._getPath(o)},e.prototype._getPath=function(t){for(var e,o=[],i=0;i<t.length;i++)(e=t[i]).createPosArray(16),o=o.concat(e.posArray);return o},e.prototype.getBezierPartArray=function(t){for(var e=[],o=0;o<t.length-1;o++){var i=this.createBezierPartArray(t[o],t[o+1]);e=e.concat(i)}return e},e.prototype.createBezierPartArray=function(t,e){var o,i,r,n,s,c,l=[],u=t.motionPath;o=cc.v2(t.value[0],t.value[1]),c=u[0],i=r=cc.v2(c[2],c[3]),n=cc.v2(c[0],c[1]),l.push(new a(o,i,r,n));for(var p=0;p<u.length-1;p++)s=u[p],c=u[p+1],o=cc.v2(s[0],s[1]),i=cc.v2(s[4],s[5]),r=cc.v2(c[2],c[3]),n=cc.v2(c[0],c[1]),l.push(new a(o,i,r,n));return s=u[u.length-1],o=cc.v2(s[0],s[1]),i=r=cc.v2(s[4],s[5]),n=cc.v2(e.value[0],e.value[1]),l.push(new a(o,i,r,n)),l},e.prototype.drawPath=function(t){this.griphics.moveTo(t[0].x,t[0].y);for(var e=1;e<t.length;e++)this.griphics.lineTo(t[e].x,t[e].y);this.griphics.stroke()},e.prototype.drawContrlPoint=function(t){for(var e=0;e<t.length;e++)this.drawPoint(t[e].startPos),this.drawPoint(t[e].cPos1,cc.Color.BLUE),this.drawPoint(t[e].cPos2,cc.Color.BLUE),this.drawPoint(t[e].endPos)},e.prototype.drawPoint=function(t,e){if(void 0===e&&(e=null),this.griphics.strokeColor=null===e?cc.Color.RED:e,t.length)for(var o=0;o<t.length;o++)this.griphics.circle(t[o].x,t[o].y,2),this.griphics.stroke();else this.griphics.circle(t.x,t.y,2),this.griphics.stroke()},e=r([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],arrowBullet:[function(t,e,o){"use strict";cc._RF.push(e,"2e66asI3tZL6KhScP56kA4Y","arrowBullet");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,a=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.decalArrow=null,e.completedArrow=null,e.sprite=null,e.arrowTower=null,e.attack=null,e.lastPos=null,e.curPos=null,e.offsetDegree=180,e.isUpdateDir=!0,e.isFallFloor=!1,e}return i(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getComponent(cc.Sprite),this.arrowTower=this.node.parent.parent.getComponent("arrowTower")},e.prototype.start=function(){},e.prototype.init=function(t,e,o){this.attack=t,this.node.rotation=o?50:-230,this.sprite.spriteFrame=this.completedArrow,this.lastPos=null,this.curPos=this.node.getPosition(),this.isUpdateDir=!0,this.isFallFloor=!1,this.scheduleOnce(this.updateDir,.07)},e.prototype.moveTo=function(t,e,o){var i=this.node.parent.convertToNodeSpaceAR(t),r=this.node.parent.convertToNodeSpaceAR(e),n=r.sub(i),s=i.add(cc.v2(n.x/2,n.y/2)),a=cc.v2(s.x,r.y+60);t.x===e.x&&(a.x+=30),this.node.setPosition(i);var c=cc.bezierTo(o,[i,a,r]),l=cc.callFunc(function(){this.isUpdateDir=!1,this.isFallFloor=!0,this.sprite.spriteFrame=this.decalArrow},this),u=cc.fadeOut(2),p=cc.callFunc(function(){this.destroySelf()},this),h=cc.sequence(c,l,u,p);this.node.runAction(h)},e.prototype.onCollisionEnter=function(t,e){if(!this.isFallFloor){var o=t.node;if("Enemy"===o.group)this.node.stopAllActions(),o.getComponent("monster").injure(this.attack),this.destroySelf()}},e.prototype.updateDir=function(){this.lastPos=this.curPos,this.curPos=this.node.getPosition();var t=this.curPos.sub(this.lastPos),e=this.getDegree(t);null!==e&&(this.node.rotation=-(this.offsetDegree+e),this.isUpdateDir&&this.scheduleOnce(this.updateDir.bind(this),.07))},e.prototype.getDegree=function(t){var e;return 0===t.x&&0===t.y?null:0===t.x&&t.y>0?90:0===t.x&&t.y<0?270:(0===(e=180*Math.atan(t.y/t.x)/Math.PI)?e=t.x>0?0:180:t.x<0&&t.y>0||t.x<0&&t.y<0?e+=180:t.x>0&&t.y<0&&(e+=360),e)},e.prototype.destroySelf=function(){this.arrowTower.releaseArrowBullt(this.node)},r([a({type:cc.SpriteFrame,tooltip:"\u534a\u622a\u7bad\u56fe\u7247"})],e.prototype,"decalArrow",void 0),r([a({type:cc.SpriteFrame,tooltip:"\u5b8c\u6574\u7684\u7bad\u56fe\u7247"})],e.prototype,"completedArrow",void 0),e=r([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],arrowTower:[function(t,e,o){"use strict";cc._RF.push(e,"403e3F1r7dJD4/WJwLaVuIm","arrowTower");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../../common/module/gameDataManager"),s=cc._decorator,a=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offsetY=[],e.arrowPrefab=null,e.atlas=[],e.level=1,e.maxLevel=4,e.leftArrower=null,e.rightArrower=null,e.towerBG=null,e.frameAnimations=[],e.toward=!1,e.dataOfTower=null,e.poolOfArrow=null,e}return i(e,t),e.prototype.onLoad=function(){var t=this.node.getChildByName("leftPerson"),e=this.node.getChildByName("rightPerson");this.frameAnimations[0]=t.getComponent("frameAnimation"),this.frameAnimations[1]=e.getComponent("frameAnimation"),this.leftArrower=t.getComponent("arrower"),this.rightArrower=e.getComponent("arrower"),this.towerBG=this.node.getChildByName("bg").getComponent(cc.Sprite),this.gameConfig=n.default.getGameConfig(),this.dataOfTower=this.gameConfig.getDataOfArrowTower(),this.createPoolOfArrow()},e.prototype.start=function(){this.wPos=this.node.parent.convertToWorldSpaceAR(this.node.getPosition()),this.init()},e.prototype.init=function(){this.attack=this.dataOfTower[this.level-1].attack,this.speedOfArrow=this.dataOfTower[this.level-1].speedOfArrow,this.shootRange=this.dataOfTower[this.level-1].shootRange,this.speedOfShoot=this.dataOfTower[this.level-1].speedOfShoot,this.price=this.dataOfTower[this.level-1].price,this.initArrower()},e.prototype.createPoolOfArrow=function(){if(null===this.poolOfArrow){this.poolOfArrow=new cc.NodePool;for(var t=0;t<2;t++)this.poolOfArrow.put(cc.instantiate(this.arrowPrefab))}},e.prototype.getArrowBullet=function(){var t=null;return(t=this.poolOfArrow.size()>0?this.poolOfArrow.get():cc.instantiate(this.arrowPrefab)).opacity=255,t},e.prototype.releaseArrowBullt=function(t){this.poolOfArrow.put(t)},e.prototype.clearPoolOfArrow=function(){this.poolOfArrow.clear()},e.prototype.initArrower=function(){this.frameAnimations[0].node.y=this.offsetY[this.level-1].y,this.frameAnimations[1].node.y=this.offsetY[this.level-1].y;var t=this.atlas[this.level-1].getSpriteFrames();this.towerBG.spriteFrame=t[0],this.setSkin(this.frameAnimations[0],t),this.setSkin(this.frameAnimations[1],t),this.leftArrower.init(this.wPos,this.speedOfArrow,this.shootRange,this.speedOfShoot,this.attack),this.rightArrower.init(this.wPos,this.speedOfArrow,this.shootRange,this.speedOfShoot,this.attack)},e.prototype.setSkin=function(t,e){var o=5;this.toward&&(o=6),t.setSpriteFrame(e[o]),t.setIdle(e[o]);var i=[];o=1,this.toward&&(o=7);for(var r=0;r<4;r++)i.push(e[o+r]);t.setFrameArray(i)},e.prototype.destroySelf=function(){this.clearPoolOfArrow(),this.node.destroy()},e.prototype.upgrade=function(){4!==this.level&&(this.level++,this.init())},e.prototype.getPriceOfUpgrade=function(){return this.dataOfTower[this.level].price},e.prototype.getDataOfTower=function(){return this.dataOfTower},e.prototype.update=function(t){},r([c({type:[cc.Vec2],tooltip:"\u5404\u7b49\u7ea7\u7684\u4eba\u7684Y\u5750\u6807"})],e.prototype,"offsetY",void 0),r([c({type:cc.Prefab})],e.prototype,"arrowPrefab",void 0),r([c([cc.SpriteAtlas])],e.prototype,"atlas",void 0),e=r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../../../common/module/gameDataManager":"gameDataManager"}],arrower:[function(t,e,o){"use strict";cc._RF.push(e,"85d98f92bBLz5Y1cmMhd2lH","arrower");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../monster/monster"),s=cc._decorator,a=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameAnimation=null,e.shooting=!1,e.arrowTower=null,e}return i(e,t),e.prototype.onLoad=function(){this.frameAnimation=this.node.getComponent("frameAnimation"),this.arrowTower=this.node.parent.getComponent("arrowTower"),this.monsterArray=n.default.monstersOfAlive},e.prototype.start=function(){this.wPosOfArrower=this.node.parent.convertToWorldSpaceAR(this.node.getPosition()),this.playTimeOfshootArrow=this.frameAnimation.getDuration()},e.prototype.init=function(t,e,o,i,r){this.wPosOfTower=t,this.speedOfArrow=e,this.shootRange=o,this.speedOfShoot=i,this.attack=r},e.prototype.shoot=function(t,e){if(void 0===e&&(e=null),!this.shooting){if(this.shooting=!0,null===e)this.wPosOfTower.sub(t).mag(),this.speedOfArrow;this.frameAnimation.play(!1,!1,!1,function(){var o,i=this.createArrow();o=this.wPosOfTower.x>t.x,i.init(this.attack,this.speedOfArrow,o),i.moveTo(this.wPosOfArrower,t,e),this.coolingShoot()}.bind(this))}},e.prototype.coolingShoot=function(){this.scheduleOnce(function(){this.shooting=!1}.bind(this),this.speedOfShoot)},e.prototype.createArrow=function(){var t=this.arrowTower.getArrowBullet();return this.node.addChild(t),t.getComponent("arrowBullet")},e.prototype.forecastMovePos=function(t,e){var o=e.sub(this.wPosOfArrower).mag()/this.speedOfArrow,i=t.getPosInTime(o+this.playTimeOfshootArrow);return this.inShootRange(i)?[i.x,i.y,o]:null},e.prototype.inShootRange=function(t){return this.wPosOfTower.sub(t).mag()<=this.shootRange},e.prototype.update=function(t){if(!this.shooting)for(var e=0;e<this.monsterArray.length;e++){var o=this.monsterArray[e],i=o.node.parent.convertToWorldSpaceAR(o.node.getPosition());if(this.inShootRange(i)){if(o.swiOfRecursionInPW){var r=this.forecastMovePos(o,i);if(null===r)continue;this.shoot(cc.v2(r[0],r[1]),r[2]);break}return void this.shoot(o.getWPos())}}},e=r([a],e)}(cc.Component));o.default=c,cc._RF.pop()},{"../../monster/monster":"monster"}],artilleryBullet:[function(t,e,o){"use strict";cc._RF.push(e,"4643fd5zIZPX7fZ/abAT8Qr","artilleryBullet");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../monster/monster"),s=cc._decorator,a=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.level=null,e.attack=0,e.frameAnim=null,e.artilleryTower=null,e}return i(e,t),e.prototype.onLoad=function(){this.frameAnim=this.node.getComponent("frameAnimation"),this.artilleryTower=this.node.parent.getComponent("artilleryTower")},e.prototype.start=function(){},e.prototype.init=function(t,e,o){this.level=t,this.attack=e,this.harmRadian=o},e.prototype.moveTo=function(t,e,o){var i=this.node.parent.convertToNodeSpaceAR(t),r=this.node.parent.convertToNodeSpaceAR(e),n=r.sub(i),s=cc.v2(i.x+n.x/2,i.y+n.y/2),a=cc.v2(s.x,r.y+60);t.x===e.x&&(a.x+=30),this.node.setPosition(i);var c=cc.bezierTo(o,[i,a,r]),l=cc.callFunc(function(){this.frameAnim.play(!1,!0,!1,function(){this.causeHarm(e),this.destroySelf()}.bind(this))},this),u=cc.sequence(c,l);this.node.runAction(u)},e.prototype.causeHarm=function(t){for(var e=0;e<n.default.monstersOfAlive.length;e++){var o=n.default.monstersOfAlive[e];this.isInjuredInScope(t,o.getWPos())&&o.injure(this.attack)}},e.prototype.isInjuredInScope=function(t,e){return e.sub(t).mag()<=this.harmRadian},e.prototype.destroySelf=function(){this.artilleryTower.releaseBullt(this.level,this.node)},e=r([a],e)}(cc.Component));o.default=c,cc._RF.pop()},{"../../monster/monster":"monster"}],artilleryTower:[function(t,e,o){"use strict";cc._RF.push(e,"fc15buo1VJP94ELmP767FOP","artilleryTower");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../../common/module/gameDataManager"),s=t("../../monster/monster"),a=cc._decorator,c=a.ccclass,l=a.property,u=function(){function t(){this.frames=[],this.bullet=[]}return r([l({type:[cc.SpriteFrame]})],t.prototype,"frames",void 0),r([l({type:[cc.SpriteFrame],tooltip:"\u70ae\u5f39\u7684\u56fe\u7247"})],t.prototype,"bullet",void 0),t=r([c("ArtilleryFrames")],t)}(),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.towers=[],e.addBulletNodes=[],e.bulletPrefab=[],e.frameAnimation=null,e.bg=null,e.addBulletData=[{startPos:cc.v2(-20,10),ctrlPos:cc.v2(-11,55),endPos:cc.v2(3,20),shootDelay:.9,addBulletDelay:1.4},{startPos:cc.v2(-22,16),ctrlPos:cc.v2(-12,55),endPos:cc.v2(3,25),shootDelay:1.1,addBulletDelay:1.8},{startPos:cc.v2(-22,16),ctrlPos:cc.v2(-13,55),endPos:cc.v2(4,25),shootDelay:.9,addBulletDelay:1.4}],e.wPos=null,e.poolsOfBullet=[],e.level=1,e.maxLevel=3,e.shootable=!1,e}return i(e,t),e.prototype.onLoad=function(){this.bg=this.node.getChildByName("bg"),this.frameAnimation=this.bg.getComponent("frameAnimation"),this.gameConfig=n.default.getGameConfig(),this.dataOfTower=this.gameConfig.getDataOfArtillery(),this.monsterArray=s.default.monstersOfAlive,this.createPoolsOfBullet()},e.prototype.start=function(){this.init()},e.prototype.init=function(){var t=this;this.attack=this.dataOfTower[this.level-1].attack,this.speedOfBullet=this.dataOfTower[this.level-1].speedOfBullet,this.bombRange=this.dataOfTower[this.level-1].bombRange,this.shootRange=this.dataOfTower[this.level-1].shootRange,this.intervalOfShoot=this.dataOfTower[this.level-1].intervalOfShoot,this.price=this.dataOfTower[this.level-1].price,this.frameAnimation.setFrameArray(this.towers[this.level-1].frames),this.frameAnimation.setSpriteFrame(this.towers[this.level-1].frames[0]),this.wPos=this.node.parent.convertToWorldSpaceAR(this.node.getPosition()),this.addBulletNodes[0].getComponent(cc.Sprite).spriteFrame=this.towers[this.level-1].bullet[0],this.addBulletAnim(),this.scheduleOnce(function(){t.shootable=!0}.bind(this),this.intervalOfShoot)},e.prototype.createPoolsOfBullet=function(){for(var t=0;t<this.bulletPrefab.length;t++){this.poolsOfBullet.push(new cc.NodePool);var e=this.bulletPrefab[t];this.poolsOfBullet[t].put(cc.instantiate(e))}},e.prototype.getBullet=function(t){var e=null;return(e=this.poolsOfBullet[t-1].size()>0?this.poolsOfBullet[t].get():cc.instantiate(this.bulletPrefab[t-1])).opacity=255,e},e.prototype.releaseBullt=function(t,e){this.poolsOfBullet[t-1].put(e)},e.prototype.clearPoolsOfBullet=function(){for(var t=0;t<this.poolsOfBullet.length;t++)this.poolsOfBullet[t].clear()},e.prototype.shoot=function(t,e){if(void 0===e&&(e=null),this.shootable){if(this.shootable=!1,null===e)this.wPos.sub(t).mag(),this.speedOfBullet;this.frameAnimation.play(!1,!1,!1,function(){var o=this;this.shootBullet(t,e),this.addBulletAnim(),this.scheduleOnce(function(){o.shootable=!0}.bind(this),this.intervalOfShoot)}.bind(this))}},e.prototype.shootBullet=function(t,e){var o=this.createBullet(),i=this.bg.convertToWorldSpaceAR(this.addBulletData[this.level-1].endPos);o.moveTo(i,t,e)},e.prototype.createBullet=function(){var t=cc.instantiate(this.bulletPrefab[this.level-1]).getComponent("artilleryBullet");this.node.addChild(t.node),t.init(this.level,this.attack,this.bombRange);this.node.getChildByName("bg");return t},e.prototype.forecastMovePos=function(t,e){var o=this.bg.convertToWorldSpaceAR(this.addBulletData[this.level-1].endPos),i=e.sub(o).mag()/this.speedOfBullet+this.addBulletData[this.level-1].shootDelay,r=t.getPosInTime(i);return this.inShootRange(r)?[r.x,r.y,i-this.addBulletData[this.level-1].shootDelay]:null},e.prototype.addBulletAnim=function(){this.addBulletNodes[0].scale=1,this.addBulletNodes[0].setPosition(this.addBulletData[this.level-1].startPos);var t=cc.bezierTo(.5,[this.addBulletData[this.level-1].startPos,this.addBulletData[this.level-1].ctrlPos,this.addBulletData[this.level-1].endPos]),e=cc.callFunc(function(){this.addBulletNodes[0].scale=0},this),o=cc.sequence(t,e);this.addBulletNodes[0].runAction(o)},e.prototype.destroySelf=function(){this.clearPoolsOfBullet(),this.node.destroy()},e.prototype.upgrade=function(){this.level!==this.maxLevel&&(this.level++,this.init())},e.prototype.getPriceOfUpgrade=function(){return this.dataOfTower[this.level].price},e.prototype.getDataOfTower=function(){return this.dataOfTower},e.prototype.inShootRange=function(t){return this.wPos.sub(t).mag()<=this.shootRange},e.prototype.update=function(t){if(this.shootable)for(var e=0;e<this.monsterArray.length;e++){var o=this.monsterArray[e],i=o.getWPos();if(this.inShootRange(i)){if(!o.swiOfRecursionInPW)return void this.shoot(o.getWPos());var r=this.forecastMovePos(o,i);if(null!==r)return void this.shoot(cc.v2(r[0],r[1]),r[2])}}},r([l({type:u,tooltip:"\u5854\u7684\u56fe\u7247\u8d44\u6e90"})],e.prototype,"towers",void 0),r([l({type:[cc.Node],tooltip:"\u586b\u5f39\u52a8\u753b\u7684\u5b50\u5f39\u7684\u8282\u70b9"})],e.prototype,"addBulletNodes",void 0),r([l({type:[cc.Prefab]})],e.prototype,"bulletPrefab",void 0),e=r([c],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../common/module/gameDataManager":"gameDataManager","../../monster/monster":"monster"}],audioSwitch:[function(t,e,o){"use strict";cc._RF.push(e,"3da8chXsqBLt5E5IHlqLyJp","audioSwitch");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../../scripts/common/module/soundsManager"),s=cc._decorator,a=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.musicOff=null,e.musicOn=null,e.effectOff=null,e.effectOn=null,e.musicSwitch=null,e.effectSwitch=null,e}return i(e,t),e.prototype.onLoad=function(){},e.prototype.start=function(){this.initSwitch()},e.prototype.initSwitch=function(){var t=n.default.ins.IsBGMMute,e=n.default.ins.IsEffectMute;this.musicSwitch.spriteFrame=t?this.musicOff:this.musicOn,this.effectSwitch.spriteFrame=e?this.effectOff:this.effectOn},e.prototype.musicSwitchButton=function(){n.default.ins.IsBGMMute?(n.default.ins.openBGM(),this.musicSwitch.spriteFrame=this.musicOn):(n.default.ins.closeBGM(),this.musicSwitch.spriteFrame=this.musicOff)},e.prototype.effecttSwitchButton=function(){n.default.ins.IsEffectMute?(n.default.ins.openEffect(),this.effectSwitch.spriteFrame=this.effectOn):(n.default.ins.closeEffect(),this.effectSwitch.spriteFrame=this.effectOff)},r([c({type:cc.SpriteFrame})],e.prototype,"musicOff",void 0),r([c({type:cc.SpriteFrame})],e.prototype,"musicOn",void 0),r([c({type:cc.SpriteFrame})],e.prototype,"effectOff",void 0),r([c({type:cc.SpriteFrame})],e.prototype,"effectOn",void 0),r([c({type:cc.Sprite})],e.prototype,"musicSwitch",void 0),r([c({type:cc.Sprite})],e.prototype,"effectSwitch",void 0),e=r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../../../scripts/common/module/soundsManager":"soundsManager"}],barrack:[function(t,e,o){"use strict";cc._RF.push(e,"d9089VY9YNLELObh8F5yn0M","barrack");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("./soldier"),s=t("../../../common/module/utils"),a=t("../../../common/module/gameDataManager"),c=cc._decorator,l=c.ccclass,u=c.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.soldierPrefab=null,e.outSoldierPos=cc.v2(0,0),e.tower1=[],e.tower2=[],e.tower3=[],e.tower4=[],e.BGFrameAnim=null,e.personMap=null,e.level=1,e.maxLevel=4,e.maxNumOfSoldier=3,e.availableStationNo=null,e.towerFrames=[],e.createdSoldiers=[],e.creSoldEnable=!0,e}return i(e,t),e.prototype.onLoad=function(){this.towerFrames.push(this.tower1),this.towerFrames.push(this.tower2),this.towerFrames.push(this.tower3),this.towerFrames.push(this.tower4),this.BGFrameAnim=this.node.getChildByName("bg").getComponent("frameAnimation"),this.personMap=cc.find("Canvas/personMap"),this.createSoldierPool();var t=a.default.getGameConfig();this.dataOfTower=t.getDataOfBarrack()},e.prototype.start=function(){this.init()},e.prototype.init=function(){this.tOfCreateSoldier=this.dataOfTower[this.level-1].tOfCreateSoldier,this.price=this.dataOfTower[this.level-1].price,this.availableStationNo=[0,1,2],this.refreshFrameAnim()},e.prototype.refreshFrameAnim=function(){this.BGFrameAnim.setFrameArray(this.towerFrames[this.level-1]),this.BGFrameAnim.setSpriteFrame(this.towerFrames[this.level-1][0])},e.prototype.createSoldierPool=function(){this.soldierPool=new cc.NodePool;for(var t=0;t<this.maxNumOfSoldier;t++){var e=cc.instantiate(this.soldierPrefab);this.soldierPool.put(e)}},e.prototype.releaseSoldier=function(t){this.availableStationNo.push(t.stationNo),s.default.remvoeItemOfArray(this.createdSoldiers,t),this.soldierPool.put(t.node)},e.prototype.destroySelf=function(){for(;this.createdSoldiers.length>0;){var t=this.createdSoldiers[0];t.die(n.default.soldiersOfAlive,t),t.releaseSelf()}this.soldierPool.clear(),this.node.destroy()},e.prototype.upgrade=function(){4!==this.level&&(this.level++,this.tOfCreateSoldier=this.dataOfTower[this.level-1].tOfCreateSoldier,this.price=this.dataOfTower[this.level-1].price,this.refreshFrameAnim())},e.prototype.getPriceOfUpgrade=function(){return this.dataOfTower[this.level].price},e.prototype.getDataOfTower=function(){return this.dataOfTower},e.prototype.autoOutSoldier=function(){this.creSoldEnable&&this.createdSoldiers.length<this.maxNumOfSoldier&&(this.creSoldEnable=!1,this.scheduleOnce(this.outSoldier.bind(this),this.tOfCreateSoldier))},e.prototype.outSoldier=function(){this.BGFrameAnim.play(!1,!1,!1,function(){this.createSoldier();this.BGFrameAnim.play(!1,!1,!0,function(){this.creSoldEnable=!0}.bind(this))}.bind(this))},e.prototype.createSoldier=function(){var t=this.getSoldierInPool(),e=t.getComponent("soldier");this.createdSoldiers.push(e),n.default.soldiersOfAlive.push(e),this.personMap.addChild(t);var o=this.node.convertToWorldSpaceAR(this.outSoldierPos);o=this.personMap.convertToNodeSpaceAR(o),t.setPosition(o);var i=this.availableStationNo.pop();return e.init(i,this.stationOfSoldier[i],this.level,this),e},e.prototype.getSoldierInPool=function(){var t;return this.soldierPool.size()>0?(t=this.soldierPool.get()).opacity=255:t=cc.instantiate(this.soldierPrefab),t},e.prototype.update=function(t){this.autoOutSoldier()},r([u({type:cc.Prefab})],e.prototype,"soldierPrefab",void 0),r([u({tooltip:"\u51fa\u5175\u70b9, \u8282\u70b9\u5750\u6807"})],e.prototype,"outSoldierPos",void 0),r([u({type:[cc.SpriteFrame]})],e.prototype,"tower1",void 0),r([u({type:[cc.SpriteFrame]})],e.prototype,"tower2",void 0),r([u({type:[cc.SpriteFrame]})],e.prototype,"tower3",void 0),r([u({type:[cc.SpriteFrame]})],e.prototype,"tower4",void 0),e=r([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../common/module/gameDataManager":"gameDataManager","../../../common/module/utils":"utils","./soldier":"soldier"}],builder:[function(t,e,o){"use strict";cc._RF.push(e,"a41detyOBVLHZsU59cvFaU2","builder");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/gameDataManager"),s=cc._decorator,a=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrowTower=null,e.barrackTower=null,e.magiclanTower=null,e.artilleryTower=null,e.graphics=null,e.buildFace=null,e.tower=null,e.g1=null,e.g2=null,e.upgrade=null,e.land=null,e.towerMap=null,e.levelScene=null,e.priceOfArrow=null,e.priceOfBarrack=null,e.priceOfMagiclan=null,e.priceOfArtillery=null,e.priceOfUpgrade=null,e.priceOfSale=null,e.timeOfFaceAction=.1,e.dataOfTower=[],e.playingOutBuildFace=!1,e.playingHiddenBuildFace=!1,e.g=null,e}return i(e,t),e.prototype.onLoad=function(){this.buildFace=this.node.getChildByName("buildFace"),this.g1=this.buildFace.getChildByName("g1"),this.g2=this.buildFace.getChildByName("g2"),this.upgrade=this.g2.getChildByName("upgrade").getComponent(cc.Button),this.land=this.node.getChildByName("land"),this.towerMap=cc.find("Canvas/towerMap"),this.levelScene=cc.find("Canvas").getComponent("levelScene"),this.stationOfSoldier=this.levelScene.levelData.stationOfSoldier;var t=n.default.getGameConfig();this.dataOfTower.push(t.getDataOfArrowTower()),this.dataOfTower.push(t.getDataOfArtillery()),this.dataOfTower.push(t.getDataOfBarrack()),this.dataOfTower.push(t.getDataOfMagiclan()),this.priceOfArrow=this.g1.getChildByName("arrow").getChildByName("price").getComponent(cc.Label),this.priceOfBarrack=this.g1.getChildByName("barrack").getChildByName("price").getComponent(cc.Label),this.priceOfMagiclan=this.g1.getChildByName("magiclan").getChildByName("price").getComponent(cc.Label),this.priceOfArtillery=this.g1.getChildByName("artillery").getChildByName("price").getComponent(cc.Label),this.priceOfUpgrade=this.g2.getChildByName("upgrade").getChildByName("price").getComponent(cc.Label),this.priceOfSale=this.g2.getChildByName("sale").getChildByName("price").getComponent(cc.Label),this.rateOfSale=t.getRateOfSale()},e.prototype.start=function(){},e.prototype.init=function(t){this.g=this.graphics.addComponent(cc.Graphics),this.g.strokeColor=this.g.fillColor=new cc.Color(0,100,0,50),this.num=t},e.prototype.outBuildFace=function(){if(!this.playingOutBuildFace){this.playingOutBuildFace=!0,this.node.zIndex=10,this.buildFace.active=!0,null===this.tower?(this.refreshPriceOfBuild(),this.g1.active=!0):(this.refreshPriceOfUpOrSele(),this.tower.level===this.tower.maxLevel?this.upgrade.interactable=!1:this.upgrade.interactable=!0,this.g2.active=!0);var t=cc.scaleTo(this.timeOfFaceAction,1).easing(cc.easeBackOut()),e=cc.callFunc(function(){this.playingOutBuildFace=!1},this),o=cc.sequence(t,e);this.buildFace.runAction(o)}},e.prototype.refreshPriceOfBuild=function(){this.setLabelInCase(this.priceOfArrow,this.dataOfTower[0][0].price),this.setLabelInCase(this.priceOfArtillery,this.dataOfTower[1][0].price),this.setLabelInCase(this.priceOfBarrack,this.dataOfTower[2][0].price),this.setLabelInCase(this.priceOfMagiclan,this.dataOfTower[3][0].price)},e.prototype.refreshPriceOfUpOrSele=function(){if(null!==this.tower){var t=this.tower.getDataOfTower();this.tower.level<t.length&&this.setLabelInCase(this.priceOfUpgrade,t[this.tower.level].price);var e=t[this.tower.level-1].price;this.priceOfSale.string=Math.floor(e*this.rateOfSale).toString()}else cc.error("[ERROR] \u5347\u7ea7\u6216\u5356\u5854\u65f6\uff0c\u53d1\u73b0\u5854\u4e3anull\u3002\u8bf7\u5904\u7406\uff01")},e.prototype.setLabelInCase=function(t,e){var o=this.levelScene.cash;t.string=e.toString(),t.node.color=e>o?cc.Color.RED:cc.Color.WHITE},e.prototype.hiddenBuildFace=function(){if(!this.playingHiddenBuildFace){this.playingHiddenBuildFace=!0,this.node.zIndex=0;var t=cc.scaleTo(this.timeOfFaceAction,0);this.buildFace.runAction(t),this.scheduleOnce(function(){this.buildFace.active=!1,this.g1.active=!1,this.g2.active=!1,this.playingHiddenBuildFace=!1}.bind(this),this.timeOfFaceAction)}},e.prototype.buildArrowTower=function(){var t=this.dataOfTower[0][0].price;this.buildTower(this.arrowTower,"arrowTower",t)},e.prototype.buildArtilleryTower=function(){var t=this.dataOfTower[1][0].price;this.buildTower(this.artilleryTower,"artilleryTower",t)},e.prototype.buildMagiclanTower=function(){var t=this.dataOfTower[3][0].price;this.buildTower(this.magiclanTower,"magiclanTower",t)},e.prototype.buildBarrackTower=function(){var t=this.dataOfTower[2][0].price;this.buildTower(this.barrackTower,"barrack",t)&&(this.tower.stationOfSoldier=this.stationOfSoldier[this.num])},e.prototype.buildTower=function(t,e,o){return!!this.levelScene.subCash(o)&&(this.tower=cc.instantiate(t).getComponent(e),this.towerMap.addChild(this.tower.node),this.tower.node.setPosition(this.node.getPosition()),this.land.opacity=0,this.hiddenBuildFaceImmediately(),this.scheduleOnce(this.drawShootRange.bind(this),.5),!0)},e.prototype.saleTower=function(){this.levelScene.addCash(this.tower.price*this.rateOfSale),this.deleteTower(),this.hiddenBuildFaceImmediately(),this.g.clear()},e.prototype.upTower=function(){var t=this.levelScene.cash,e=this.tower.getPriceOfUpgrade();t<e||(this.levelScene.subCash(e),this.tower.upgrade(),this.drawShootRange(),this.tower.level!==this.tower.maxLevel?this.refreshPriceOfUpOrSele():this.upgrade.interactable=!1)},e.prototype.hiddenBuildFaceImmediately=function(){this.buildFace.scale=0,this.buildFace.active=!1,this.g1.active=!1,this.g2.active=!1},e.prototype.deleteTower=function(){null!==this.tower&&(this.tower.destroySelf(),this.g.clear(),this.tower=null,this.land.opacity=255)},e.prototype.drawShootRange=function(){void 0!==this.tower.shootRange&&(this.g.clear(),this.g.circle(0,0,this.tower.shootRange),this.g.stroke(),this.g.fill())},r([c({type:cc.Prefab})],e.prototype,"arrowTower",void 0),r([c({type:cc.Prefab})],e.prototype,"barrackTower",void 0),r([c({type:cc.Prefab})],e.prototype,"magiclanTower",void 0),r([c({type:cc.Prefab})],e.prototype,"artilleryTower",void 0),r([c({type:cc.Node})],e.prototype,"graphics",void 0),e=r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../common/module/gameDataManager":"gameDataManager"}],combatLogic:[function(t,e,o){"use strict";cc._RF.push(e,"e10f6wa86tCgJoy21R6dWZQ","combatLogic"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(t,e){this.host=null,this.enemys=null,this.host=t,this.enemys=e}return t.prototype.think=function(){var t=this.getEnemyOfMinDis();if(null!==t){var e=t[0],o=t[1];if(o<=this.host.rangeOfAttack)this.host.isTracking?(this.host.stopTrack(),this.host.attack(e)):this.host.isAttacking||this.host.attack(e);else if(o<=this.host.rangeOfInvestigate)if(this.host.isNonComState)this.host.stopNonComLogic(),this.host.track(e.getWPos());else if(null===this.host.isNonComState)this.host.isNonComState=!1,this.host.track(e.getWPos());else if(this.host.isTracking)this.host.refreshTrackTarget(e.getWPos());else{if(this.host.isAttacking)return;this.host.track(e.getWPos())}else this.host.isNonComState||this.host.nonComLogic()}else this.host.isTracking?(this.host.stopTrack(),this.host.nonComLogic()):this.host.isNonComState||this.host.nonComLogic()},t.prototype.getEnemyOfMinDis=function(){if(0===this.enemys.length)return null;for(var t=this.enemys[0],e=this.host.node.getPosition(),o=t.node.getPosition(),i=e.sub(o).mag(),r=1;r<this.enemys.length;r++){var n=this.enemys[r];o=n.node.getPosition();var s=e.sub(o).mag();s<i&&(i=s,t=n)}return[t,i]},t}();o.default=i,cc._RF.pop()},{}],creature:[function(t,e,o){"use strict";cc._RF.push(e,"eff2dfpDpVJZIVXft5Z35uY","creature");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/frameAnimation"),s=t("../common/module/utils"),a=cc._decorator,c=a.ccclass,l=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cHP=null,e.maxHp=null,e.speedOfMove=null,e.intervalOfAttack=null,e.aggressivity=null,e.rangeOfAttack=null,e.rangeOfInvestigate=null,e.intervalOfThink=1,e.bloodBar=null,e.frameAnim=null,e.combatLogic=null,e._move=null,e.isAlive=!1,e.isTracking=!1,e.isAttacking=!1,e.isNonComState=!1,e}return i(e,t),e.prototype.initCreature=function(){this.isTracking=!1,this.isAttacking=!1,this.isNonComState=null,this.isAlive=!0},e.prototype.move=function(t,e,o){void 0===e&&(e=null),void 0===o&&(o=null);var i=this.node.parent.convertToNodeSpaceAR(t),r=this.node.getPosition(),n=i.sub(r);null===o&&(o=n.mag()/this.speedOfMove);this._move.moveTo(n,o,e)},e.prototype.playDie=function(t,e){void 0===e&&(e=null),this.isNonComState?this.stopNonComLogic():this.isAttacking?this.frameAnim.stop():this.isTracking&&this.stopTrack(),this.frameAnim.setFrameArray(t),this.frameAnim.play(!1,!1,!1,function(){var t=cc.fadeOut(1),o=cc.callFunc(e);this.node.runAction(cc.sequence(t,o))}.bind(this))},e.prototype.die=function(t,e){this.isAlive=!1,s.default.remvoeItemOfArray(t,e)},e.prototype.updateDir=function(t){var e=this.getWPos();t.x>e.x?this.node.scaleX=1:this.node.scaleX=-1},e.prototype.getWPos=function(){return this.node.parent.convertToWorldSpaceAR(this.node.getPosition())},e.prototype.injure=function(t){0!==this.cHP&&(this.cHP-=t,this.cHP<0&&(this.cHP=0))},e.prototype.refreshBloodBar=function(){var t=this.cHP/this.maxHp;this.bloodBar.progress=t},e.prototype.update=function(t){this.isAlive&&(this.combatLogic.think(),this._move.refreshMove(t),this.refreshState())},r([l({type:cc.ProgressBar})],e.prototype,"bloodBar",void 0),r([l({type:n.default})],e.prototype,"frameAnim",void 0),e=r([c],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../common/frameAnimation":"frameAnimation","../common/module/utils":"utils"}],frameAnimation:[function(t,e,o){"use strict";cc._RF.push(e,"fd612rCcO5GqopQOUeviCbD","frameAnimation");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,a=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playSpeed=.1,e.spriteFrames=[],e.idle=null,e.playOnLoad=!1,e.sprite=null,e.isPlay=!1,e.nextIndex=0,e.timeSum=0,e.backFunc=null,e.isLoop=!1,e.isInvertedPlay=!1,e.isFirstFrameInEnd=!0,e}return i(e,t),e.prototype.onLoad=function(){this.sprite=this.node.getComponent(cc.Sprite)},e.prototype.start=function(){this.playOnLoad&&this.play(!0)},e.prototype.play=function(t,e,o,i){void 0===e&&(e=!0),void 0===o&&(o=!1),void 0===i&&(i=null),this.isLoop=t,this.backFunc=i,this.isFirstFrameInEnd=e,this.nextIndex=0,this.timeSum=0,this.isInvertedPlay=o,this.isInvertedPlay&&this.spriteFrames.reverse(),this.setSpriteFrame(this.spriteFrames[this.nextIndex++]),this.isPlay=!0},e.prototype.stop=function(){this.isPlay=!1,null===this.idle?this.sprite.spriteFrame=this.spriteFrames[0]:this.sprite.spriteFrame=this.idle},e.prototype.pause=function(){this.isPlay=!1},e.prototype.continue=function(){this.isPlay=!0},e.prototype.setIdle=function(t){this.idle=t},e.prototype.setSpriteFrame=function(t){this.sprite.spriteFrame=t},e.prototype.setFrameArray=function(t){this.spriteFrames=[];for(var e=0;e<t.length;e++)this.spriteFrames.push(t[e])},e.prototype.getSpriteFrame=function(){return this.sprite.spriteFrame},e.prototype.getDuration=function(){return this.playSpeed*this.spriteFrames.length},e.prototype.update=function(t){if(this.isPlay&&(this.timeSum+=t,this.timeSum>=this.playSpeed&&(this.sprite.spriteFrame=this.spriteFrames[this.nextIndex++],this.timeSum=0,this.nextIndex>=this.spriteFrames.length))){if(!this.isLoop)return this.isPlay=!1,this.idle?this.sprite.spriteFrame=this.idle:this.isFirstFrameInEnd&&(this.sprite.spriteFrame=this.spriteFrames[0]),this.isInvertedPlay&&(this.spriteFrames.reverse(),this.isInvertedPlay=!1),void(null!==this.backFunc&&this.backFunc());this.nextIndex=0}},r([a({displayName:"\u64ad\u653e\u901f\u5ea6",tooltip:"\u591a\u5c11\u79d2\u64ad\u653e\u4e00\u5e27"})],e.prototype,"playSpeed",void 0),r([a({type:[cc.SpriteFrame],tooltip:"\u5e27\u56fe\u7247"})],e.prototype,"spriteFrames",void 0),r([a({type:cc.SpriteFrame,tooltip:"\u52a8\u753b\u64ad\u653e\u5b8c\u540e\u7684\u7981\u6b62\u72b6\u6001\u7684\u56fe\u7247\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u4f1a\u663e\u793a\u7b2c\u4e00\u5e27"})],e.prototype,"idle",void 0),r([a({})],e.prototype,"playOnLoad",void 0),e=r([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],gameDataManager:[function(t,e,o){"use strict";cc._RF.push(e,"6ae87mdjG1K8KqpOrD6pjkT","gameDataManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./utils"),r=t("./storageManager"),n=function(){function t(t){this.initUserData={username:"\u65e0",levelsReview:[],currentHaveStarNum:0,skillsLevel:[0,0,0,0,0,0]},this.userData=null,this.ls=cc.sys.localStorage,this.userData=r.default.ins.getData("userData:"+t),null===this.userData?(this.userData=this.initUserData,this.userData.username=t):this.userData=JSON.parse(this.userData)}return t.prototype.getUsername=function(){return this.userData.username},t.prototype.resetSkill=function(){this.userData.skillsLevel.fill(0),this.userData.currentHaveStarNum=this.getStarSum()},t.prototype.getCurrentHaveStarNum=function(){return this.userData.currentHaveStarNum},t.prototype.subHavedStar=function(t){this.userData.currentHaveStarNum-=t},t.prototype.addHavedStar=function(t){this.userData.currentHaveStarNum+=t},t.prototype.getStarSum=function(){if(null!==this.userData){for(var t=0,e=0;e<this.userData.levelsReview.length;e++)t+=this.userData.levelsReview[e];return t}},t.prototype.getRushLevelsSum=function(){if(null!==this.userData)return this.userData.levelsReview.length},t.prototype.getLevelsReview=function(){if(null!==this.userData)return this.userData.levelsReview},t.prototype.setLevelReview=function(t,e){if(t>this.userData.rushLevelsSum)this.userData.rushLevelsSum=t;else{if(void 0===this.userData.levelsReview[t])this.userData.levelsReview[t]=e,this.addHavedStar(e);else if(this.userData.levelsReview[t]<e){var o=e-this.userData.levelsReview[t];this.userData.levelsReview[t]=e,this.addHavedStar(o)}this.preseverData()}},t.prototype.getSkillsLevel=function(){if(null!==this.userData)return this.userData.skillsLevel},t.prototype.preseverData=function(){r.default.ins.storageData("userData:"+this.userData.username,JSON.stringify(this.userData)),console.log("\u4fdd\u5b58\u7528\u6237\u6570\u636e:",this.userData)},t}();o.User=n;var s=function(){function t(t){this.gameConfig=null,this.gameConfig=t,console.log("\u65b0\u5efa\u4e00\u4e2aGameConfig\u5bf9\u8c61\uff0c\u663e\u793ajson\u5bf9\u8c61:\n",this.gameConfig)}return t.prototype.getRateOfSale=function(){return this.gameConfig.rateOfSale},t.prototype.getInitChip=function(){return this.gameConfig.initChip},t.prototype.getInitBlood=function(){return this.gameConfig.initBlood},t.prototype.getTowerUpNeedStar=function(){return this.gameConfig.towerUpNeedStar},t.prototype.getSkillsUpNeedStar=function(){return this.gameConfig.skillsUpNeedStar},t.prototype.getLevelsSum=function(){return this.gameConfig.levelsSum},t.prototype.getStarSum=function(){return 3*this.gameConfig.levelsSum},t.prototype.getSoldierData=function(){return this.gameConfig.soldierData},t.prototype.getMonsterData=function(){return this.gameConfig.mosterData},t.prototype.getDataOfArrowTower=function(){return this.gameConfig.dataOfTower.arrowTower},t.prototype.getDataOfArtillery=function(){return this.gameConfig.dataOfTower.artillery},t.prototype.getDataOfBarrack=function(){return this.gameConfig.dataOfTower.barrack},t.prototype.getDataOfMagiclan=function(){return this.gameConfig.dataOfTower.magiclan},t}();o.GameConfig=s;var a=function(){function t(){}return t.init=function(t){this.gameConfig=new s(t),this.usernames=this.getNamesOfAllUser();for(var e=0;e<this.usernames.length;e++)this.users.push(new n(this.usernames[e]))},t.getNamesOfAllUser=function(){var t=r.default.ins.getData("namesOfAllUser");return null===t?[]:JSON.parse(t)},t.preserveNamesOfAllUser=function(){if(this.usernames.length>0){var t=JSON.stringify(this.usernames);r.default.ins.storageData("namesOfAllUser",t),console.log("\u6240\u6709\u7528\u6237\u540d\u4fdd\u5b58\u6210\u529f!")}},t.getGameConfig=function(){return this.gameConfig},t.getCurrentUser=function(){return this.currentUser},t.setCurrentUser=function(t){this.currentUser=t},t.getUsers=function(){return this.users},t.createUser=function(t){var e=new n(t);this.users.push(e),this.usernames.push(t),this.preserveNamesOfAllUser(),e.preseverData()},t.delUser=function(t){i.default.remvoeItemOfArray(this.usernames,t);for(var e=0;e<this.users.length;e++)if(this.users[e].getUsername()===t){this.users.splice(e,1);break}r.default.ins.removeData("userData:"+t),this.preserveNamesOfAllUser()},t.preserveGameData=function(){for(var t=0,e=this.users;t<e.length;t++){e[t].preseverData()}this.preserveNamesOfAllUser()},t.gameConfig=null,t.users=[],t.usernames=null,t.currentUser=null,t.ls=cc.sys.localStorage,t}();o.default=a,cc._RF.pop()},{"./storageManager":"storageManager","./utils":"utils"}],homeScene:[function(t,e,o){"use strict";cc._RF.push(e,"404edzKX+lMA7Ol3dvE0/bm","homeScene");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/soundsManager"),s=t("./startAnim"),a=t("../common/module/gameDataManager"),c=t("../common/module/levelDataManager"),l=t("../../res/prefabs/loadingDoorAnim/loadingDoorAnim"),u=t("../common/module/storageManager"),p=cc._decorator,h=p.ccclass,f=p.property,d=function(){function t(){this.gameConfig=null,this.levelConfig=null}return r([f({type:cc.JsonAsset,displayName:"\u6e38\u620f\u914d\u7f6e"})],t.prototype,"gameConfig",void 0),r([f({type:cc.JsonAsset,displayName:"\u5173\u5361\u914d\u7f6e"})],t.prototype,"levelConfig",void 0),t=r([h("ConfigFiles")],t)}(),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.conFigFiles=new d,e.loadingDoorAnim=null,e.startAnim=null,e.isStartGame=!1,e.isAboutButton=!1,e.fristEntry=!0,e.clips=null,e}return i(e,t),e.prototype.onLoad=function(){null===a.default.getGameConfig()&&(u.default.init(),n.default.init(),a.default.init(this.conFigFiles.gameConfig.json),c.default.initLevelData(this.conFigFiles.levelConfig.json)),this.clips=this.startAnim.node.getComponent(cc.Animation).getClips()},e.prototype.start=function(){console.log("\u672c\u5730\u6570\u636e:",cc.sys.localStorage),n.default.ins.curBGM="sounds/home_scene_bg",n.default.ins.playBGM("sounds/home_scene_bg"),this.fristEntry&&this.startAnim.logoDown()},e.prototype.startGame=function(){if(!this.isStartGame){this.isStartGame=!0,n.default.ins.playEffect("sounds/click"),this.startAnim.buttonUp();var t=cc.delayTime(this.clips[1].duration),e=cc.callFunc(function(){this.isStartGame=!1},this),o=cc.sequence(t,e);this.node.runAction(o)}},e.prototype.aboutButton=function(){if(!this.isAboutButton){this.isAboutButton=!0,n.default.ins.playEffect("sounds/click");var t=cc.callFunc(function(){cc.director.loadScene("aboutScene")},this);this.loadingDoorAnim.closeDoor(t),a.default.preserveGameData()}},e.prototype.selectLevelScene=function(t){var e=a.default.getUsers();a.default.setCurrentUser(e[t]),n.default.ins.playEffect("sounds/click");var o=cc.callFunc(function(){cc.director.loadScene("selectLevelScene")},this);this.loadingDoorAnim.closeDoor(o),a.default.preserveGameData()},r([f({type:d,displayName:"\u6e38\u620f\u914d\u7f6e\u6587\u4ef6"})],e.prototype,"conFigFiles",void 0),r([f({type:l.default})],e.prototype,"loadingDoorAnim",void 0),r([f({type:s.default})],e.prototype,"startAnim",void 0),e=r([h],e)}(cc.Component);o.default=m,cc._RF.pop()},{"../../res/prefabs/loadingDoorAnim/loadingDoorAnim":"loadingDoorAnim","../common/module/gameDataManager":"gameDataManager","../common/module/levelDataManager":"levelDataManager","../common/module/soundsManager":"soundsManager","../common/module/storageManager":"storageManager","./startAnim":"startAnim"}],levelDataManager:[function(t,e,o){"use strict";cc._RF.push(e,"048a38YZ0JHh7ULHzbwxqf+","levelDataManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.initLevelData=function(t){for(var e,o=0,i=t;o<i.length;o++){e=i[o];var r=this.initLevel(e);this.levelDatas.push(r)}console.log("\u5173\u5361\u4fe1\u606f:",this.levelDatas)},t.initLevel=function(t){var e=new r;return e.roadNum=t.roadNum,e.posOfBuilders=t.posOfBuilders,e.noOfRound=t.noOfRound,e.timeOfRound=t.timeOfRound,e.stationOfSoldier=t.stationOfSoldier,e},t.getLevelData=function(t){return this.levelDatas[t-1]},t.levelDatas=[],t}();o.default=i;var r=function(){return function(){}}();o.Level=r,cc._RF.pop()},{}],levelManager:[function(t,e,o){"use strict";cc._RF.push(e,"ef3f0LnHIFBe52D+Rwl4IqK","levelManager");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/gameDataManager"),s=t("../common/module/soundsManager"),a=cc._decorator,c=a.ccclass,l=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.levels=null,e.isLevelButton=!1,e.selectLevelScene=null,e.levelEntry=null,e.MaxLevelNum=null,e}return i(e,t),e.prototype.onLoad=function(){this.levels=this.node.children,this.selectLevelScene=cc.find("Canvas").getComponent("selectLevelScene"),this.levelEntry=this.levels[this.levels.length-1],this.MaxLevelNum=n.default.getGameConfig().getLevelsSum()},e.prototype.start=function(){this.buttonEventBind()},e.prototype.buttonEventBind=function(){for(var t=this.node.children,e=0;e<t.length;e++){var o=t[e].getComponent(cc.Button),i=new cc.Component.EventHandler;i.target=this.node,i.component="levelManager",i.handler="levelButtonFunc",i.customEventData=(e+1).toString(),o.clickEvents.push(i)}},e.prototype.levelButtonFunc=function(t,e){this.isLevelButton||(this.isLevelButton=!0,s.default.ins.playEffect("sounds/click"),e>this.MaxLevelNum?this.selectLevelScene.toLevelScene(this.newLevel):this.selectLevelScene.toLevelScene(e))},e.prototype.updateLevelMap=function(t){for(var e=t.getRushLevelsSum(),o=t.getLevelsReview(),i=0;i<e;i++){for(var r=this.levels[i],s=r.children,a=o[i],c=0;c<a;c++){s[c+1].getChildByName("emptyStar").active=!1}r.active=!0}if(!(e+1>n.default.getGameConfig().getLevelsSum())){var l=this.levels[e],u=l.getPosition();this.levelEntry.setPosition(u),this.levelEntry.active=!0,this.newLevel=e+1;var p=l.getComponent(cc.Button),h=new cc.Component.EventHandler;h.target=this.node,h.component="levelManager",h.handler="levelButtonFunc",h.customEventData=(e+1).toString(),p.clickEvents.push(h)}},e=r([c],e)}(cc.Component));o.default=l,cc._RF.pop()},{"../common/module/gameDataManager":"gameDataManager","../common/module/soundsManager":"soundsManager"}],levelScene:[function(t,e,o){"use strict";cc._RF.push(e,"74c8cuMGjBCIZa2ZsXkSCsR","levelScene");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/gameDataManager"),s=t("./monster/monsterFactory"),a=t("./V_gameState"),c=t("../common/module/utils"),l=t("./monster/monster"),u=t("../common/module/levelDataManager"),p=t("../../res/prefabs/loadingDoorAnim/loadingDoorAnim"),h=t("../common/module/soundsManager"),f=t("./tower/barrack/soldier"),d=cc._decorator,m=d.ccclass,y=d.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingDoorAnim=null,e.pauseFace=null,e.setFace=null,e.monsterFactory=null,e.builderPrefab=null,e.V_gameState=null,e.isDebug=!1,e.spriteOfMap=null,e.user=null,e.isBackButton=!1,e.isExitButton=!1,e.startGame=!1,e.cT=0,e.monsterArray=null,e.gameConfig=null,e.animOfVPMap=null,e.builderMap=null,e.settlementFace=null,e}return i(e,t),e.prototype.onLoad=function(){this.settlementFace=cc.find("Canvas/centerUI/settlementFace").getComponent("settlementFace"),this.gameConfig=n.default.getGameConfig(),this.animOfVPMap=cc.find("Canvas/VPMap").getComponent(cc.Animation),this.builderMap=cc.find("Canvas/builderMap"),this.monsterArray=l.default.monstersOfAlive,this.user=n.default.getCurrentUser(),f.default.soldiersOfAlive=[],console.log("\u58eb\u5175\u6570\u7ec4",f.default.soldiersOfAlive)},e.prototype.start=function(){this.buildScene(),console.log("#\u8fdb\u5165\u5173\u5361"+this.levelNum),h.default.ins.curBGM="sounds/gameBGM/game_bg"+c.default.getRandomInterger(1,5),h.default.ins.playBGM(h.default.ins.curBGM);var t=cc.director.getCollisionManager();t.enabled=!0,this.isDebug&&(t.enabledDebugDraw=!0,t.enabledDrawBoundingBox=!0)},e.prototype.buildScene=function(){cc.loader.loadRes("levelData/level"+this.levelNum+"/roadData",cc.AnimationClip,function(t,e){this.animOfVPMap.addClip(e),this.levelData=u.default.getLevelData(this.levelNum);for(var o=this.levelData.posOfBuilders,i=0;i<o.length;i++){var r=cc.instantiate(this.builderPrefab),n=r.getComponent("builder");this.builderMap.addChild(r),r.setPosition(o[i]),n.init(i)}cc.loader.loadRes("levelData/level"+this.levelNum+"/map"+this.levelNum,cc.SpriteFrame,function(t,e){this.spriteOfMap.spriteFrame=e,this.init(),this.loadingDoorAnim.openDoor(),this.startGame=!0}.bind(this))}.bind(this))},e.prototype.init=function(){this.HP=this.maxHP=this.gameConfig.getInitBlood(),this.cash=this.gameConfig.getInitChip(),this.maxRound=this.levelData.noOfRound.length,this.gameReview=0,this.V_gameState.setHP(this.HP),this.V_gameState.setGold(this.cash),this.V_gameState.setRound(1,this.maxRound),this.roundIndex=1,this.cT=0,this.monsterFactory.init(this.levelData.roadNum)},e.prototype.subHP=function(){this.HP--,this.V_gameState.setHP(this.HP),this.HP<=0&&(this.startGame=!1,this.settlementFace.outFailFace())},e.prototype.subCash=function(t){return!(this.cash<t)&&(this.cash-=t,this.V_gameState.setGold(this.cash),!0)},e.prototype.addCash=function(t){this.cash+=t,this.V_gameState.setGold(this.cash)},e.prototype.backButton=function(){if(!this.isBackButton){this.isBackButton=!0,h.default.ins.playEffect("sounds/click");var t=cc.callFunc(function(){cc.director.loadScene("selectLevelScene",function(){var t=cc.find("Canvas/loadingDoorAnim").getComponent("loadingDoorAnim");t.setState(!1),t.openDoor()})},this);this.loadingDoorAnim.closeDoor(t),n.default.preserveGameData()}},e.prototype.pauseButton=function(){this.pauseFace.active=!0,this.pauseFace.runAction(cc.fadeIn(.2)),this.scheduleOnce(function(){cc.director.pause()},.2)},e.prototype.resumeButton=function(){cc.director.resume(),this.pauseFace.runAction(cc.fadeOut(.2)),this.scheduleOnce(function(){this.pauseFace.active=!1}.bind(this),.2)},e.prototype.setButton=function(){this.setFace.active=!0,this.setFace.runAction(cc.fadeIn(.2)),this.scheduleOnce(function(){cc.director.pause()},.2)},e.prototype.closeButton=function(){cc.director.resume(),this.setFace.runAction(cc.fadeOut(.2)),this.scheduleOnce(function(){this.setFace.active=!1}.bind(this),.2)},e.prototype.resetButton=function(){cc.director.resume(),this.setFace.active?(this.setFace.runAction(cc.fadeOut(.2)),this.scheduleOnce(function(){this.setFace.active=!1},.2)):this.settlementFace.hiddenSettleFace(),this.monsterFactory.clearMonsters(),this.monsterFactory.init(this.levelData.roadNum),this.resetLand(),this.init(),this.startGame=!0},e.prototype.exitButton=function(){if(cc.director.resume(),this.settlementFace.hiddenSettleFace(),!this.isExitButton){this.isExitButton=!0,h.default.ins.playEffect("sounds/click");var t=cc.callFunc(function(){cc.director.loadScene("selectLevelScene")},this);this.loadingDoorAnim.closeDoor(t),n.default.preserveGameData()}},e.prototype.resetLand=function(){this.builderMap.children.forEach(function(t){var e=t.getComponent("builder");e.deleteTower(),e.hiddenBuildFaceImmediately()})},e.prototype.refreshRound=function(t){if(this.roundIndex<=this.maxRound){if(this.cT+=t,this.cT>=this.levelData.timeOfRound[this.roundIndex-1]){this.V_gameState.setRound(this.roundIndex,this.maxRound);for(var e=this.levelData.noOfRound,o=e[this.roundIndex-1],i=0;i<o.length;i++)this.monsterFactory.createMonster(e[this.roundIndex-1][i]);this.cT=0,this.roundIndex++}}else 0===l.default.monstersOfAlive.length&&0===this.monsterFactory.creMonList.length&&this.HP>0&&(this.HP===this.maxHP?this.gameReview=3:this.HP>=this.maxHP/2?this.gameReview=2:this.gameReview=1,this.settlementFace.outPassFace(this.gameReview),this.startGame=!1,this.user.setLevelReview(this.levelNum-1,this.gameReview))},e.prototype.update=function(t){this.startGame&&this.refreshRound(t)},r([y({type:p.default})],e.prototype,"loadingDoorAnim",void 0),r([y({type:cc.Node})],e.prototype,"pauseFace",void 0),r([y({type:cc.Node})],e.prototype,"setFace",void 0),r([y({type:s.default})],e.prototype,"monsterFactory",void 0),r([y({type:cc.Prefab})],e.prototype,"builderPrefab",void 0),r([y({type:a.default})],e.prototype,"V_gameState",void 0),r([y({})],e.prototype,"isDebug",void 0),r([y({type:cc.Sprite,displayName:"\u5730\u56fe"})],e.prototype,"spriteOfMap",void 0),e=r([m],e)}(cc.Component);o.default=g,cc._RF.pop()},{"../../res/prefabs/loadingDoorAnim/loadingDoorAnim":"loadingDoorAnim","../common/module/gameDataManager":"gameDataManager","../common/module/levelDataManager":"levelDataManager","../common/module/soundsManager":"soundsManager","../common/module/utils":"utils","./V_gameState":"V_gameState","./monster/monster":"monster","./monster/monsterFactory":"monsterFactory","./tower/barrack/soldier":"soldier"}],loadingDoorAnim:[function(t,e,o){"use strict";cc._RF.push(e,"eb3cfoKNhhKUYqSuYQiQcM8","loadingDoorAnim");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../../scripts/common/module/soundsManager"),s=cc._decorator,a=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.time=1,e.lDoor=null,e.rDoor=null,e.isDoorOpen=!0,e.viewSize=null,e}return i(e,t),e.prototype.onLoad=function(){this.lDoor=this.node.getChildByName("lDoor"),this.rDoor=this.node.getChildByName("rDoor"),this.viewSize=cc.view.getVisibleSize(),this.setState(!0)},e.prototype.start=function(){},e.prototype.setState=function(t){t?(this.lDoor.setPosition(cc.v2(-this.viewSize.width,0)),this.rDoor.setPosition(cc.v2(this.viewSize.width,0)),this.isDoorOpen=!0):(this.lDoor.setPosition(cc.v2(2,0)),this.rDoor.setPosition(cc.v2(-2,0)),this.isDoorOpen=!1)},e.prototype.openDoor=function(){if(!this.isDoorOpen){var t=cc.delayTime(1),e=cc.callFunc(function(){var t=cc.moveTo(this.time,cc.v2(-this.viewSize.width,0)).easing(cc.easeIn(2)),e=cc.moveTo(this.time,cc.v2(this.viewSize.width,0)).easing(cc.easeIn(2));this.lDoor.runAction(t),this.rDoor.runAction(e)}.bind(this)),o=cc.sequence(t,e);this.node.runAction(o),this.isDoorOpen=!0}},e.prototype.closeDoor=function(t){if(this.isDoorOpen){var e=cc.moveTo(this.time,cc.v2(2,0)).easing(cc.easeIn(2)),o=cc.moveTo(this.time,cc.v2(-2,0)).easing(cc.easeIn(2)),i=cc.callFunc(function(){n.default.ins.playEffect("sounds/close_door")},this),r=cc.sequence(o,i,t);this.lDoor.runAction(e),this.rDoor.runAction(r),this.isDoorOpen=!1}},r([c({displayName:"\u5f00\u5173\u95e8\u65f6\u95f4"})],e.prototype,"time",void 0),e=r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../../../scripts/common/module/soundsManager":"soundsManager"}],magiclanBullet:[function(t,e,o){"use strict";cc._RF.push(e,"4b9a4I8TTtBsL72juFLMOm2","magiclanBullet");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,a=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFallFloor=!1,e.tower=null,e}return i(e,t),e.prototype.onLoad=function(){this.tower=this.node.parent.getComponent("magiclanTower")},e.prototype.start=function(){},e.prototype.init=function(t){this.attack=t},e.prototype.moveTo=function(t,e,o){var i=this.node.parent.convertToNodeSpaceAR(t),r=this.node.parent.convertToNodeSpaceAR(e),n=r.sub(i),s=cc.v2(i.x+n.x/2,i.y+n.y/2),a=cc.v2(s.x,r.y+60);t.x===e.x&&(a.x+=30),this.node.setPosition(i);var c=cc.bezierTo(o,[i,a,r]),l=cc.callFunc(function(){this.destroySelf()}.bind(this)),u=cc.sequence(c,l);this.node.runAction(u)},e.prototype.destroySelf=function(){this.tower.releaseBullt(this.node)},e.prototype.onCollisionEnter=function(t,e){if(!this.isFallFloor){var o=t.node;if("Enemy"===o.group)this.node.stopAllActions(),o.getComponent("monster").injure(this.attack),this.destroySelf()}},e=r([s],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],magiclanTower:[function(t,e,o){"use strict";cc._RF.push(e,"faf39emRepGoLTsKitSfC/j","magiclanTower");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../monster/monster"),s=t("../../../common/module/gameDataManager"),a=cc._decorator,c=a.ccclass,l=a.property,u=function(){function t(){this.frames=[]}return r([l({type:[cc.SpriteFrame]})],t.prototype,"frames",void 0),t=r([c("MagiclanFrames")],t)}(),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offsetY=[],e.framesArray=[],e.magiclanFrames=[],e.bulletPrefab=null,e.PosOfShoot=null,e.magiclanAF=null,e.towerAF=null,e.bg=null,e.level=1,e.maxLevel=4,e.toward=!1,e.isShoot=!1,e.wPos=null,e.poolOfBullet=null,e}return i(e,t),e.prototype.onLoad=function(){this.magiclanAF=this.node.getChildByName("magiclan").getComponent("frameAnimation"),this.towerAF=this.node.getChildByName("bg").getComponent("frameAnimation"),this.bg=this.node.getChildByName("bg"),this.monsterArray=n.default.monstersOfAlive;var t=s.default.getGameConfig();this.dataOfTower=t.getDataOfMagiclan(),this.createPoolOfBullet()},e.prototype.start=function(){this.wPos=this.node.parent.convertToWorldSpaceAR(this.node.getPosition()),this.wPOfShoot=this.PosOfShoot.parent.convertToWorldSpaceAR(this.PosOfShoot.getPosition()),this.init()},e.prototype.init=function(){this.attack=this.dataOfTower[this.level-1].attack,this.speedOfShoot=this.dataOfTower[this.level-1].speedOfShoot,this.speedOfBullet=this.dataOfTower[this.level-1].speedOfBullet,this.shootRange=this.dataOfTower[this.level-1].shootRange,this.price=this.dataOfTower[this.level-1].price,this.initMagiclanAF(),this.initTowerAF()},e.prototype.createPoolOfBullet=function(){if(null===this.poolOfBullet){this.poolOfBullet=new cc.NodePool;for(var t=0;t<1;t++)this.poolOfBullet.put(cc.instantiate(this.bulletPrefab))}},e.prototype.getBullet=function(){var t=null;return(t=this.poolOfBullet.size()>0?this.poolOfBullet.get():cc.instantiate(this.bulletPrefab)).opacity=255,t},e.prototype.releaseBullt=function(t){this.poolOfBullet.put(t)},e.prototype.clearPoolOfBullet=function(){this.poolOfBullet.clear()},e.prototype.initMagiclanAF=function(){var t;t=4===this.level?2:0,this.toward&&t++,this.magiclanAF.setFrameArray(this.magiclanFrames[t].frames),this.magiclanAF.setSpriteFrame(this.magiclanFrames[t].frames[0]),this.playTOfShoot=this.magiclanAF.getDuration(),this.magiclanAF.node.setPosition(this.offsetY[this.level-1])},e.prototype.changeToward=function(t){t!==this.toward&&(this.toward=t,this.initMagiclanAF())},e.prototype.initTowerAF=function(){this.towerAF.setFrameArray(this.framesArray[this.level-1].frames),this.towerAF.setSpriteFrame(this.framesArray[this.level-1].frames[0])},e.prototype.shoot=function(t,e){if(void 0===e&&(e=null),!this.isShoot){if(this.isShoot=!0,null===e)this.wPos.sub(t).mag(),this.speedOfBullet;var o=this.node.convertToWorldSpaceAR(this.magiclanAF.node.getPosition());o.y>t.y&&!0===this.toward?this.toward=!1:o.y<t.y&&!1===this.toward&&(this.toward=!0),this.initMagiclanAF(),this.towerAF.play(!1),this.magiclanAF.play(!1,!0,!1,function(){this.createBullet().moveTo(this.wPOfShoot,t,e),this.coolingShoot()}.bind(this))}},e.prototype.coolingShoot=function(){this.scheduleOnce(function(){this.isShoot=!1}.bind(this),this.speedOfShoot)},e.prototype.createBullet=function(){var t=this.getBullet(),e=t.getComponent("magiclanBullet");return this.node.addChild(t),e.init(this.attack),e},e.prototype.destroySelf=function(){this.clearPoolOfBullet(),this.node.destroy()},e.prototype.upgrade=function(){4!==this.level&&(this.level++,this.init())},e.prototype.getPriceOfUpgrade=function(){return this.dataOfTower[this.level].price},e.prototype.getDataOfTower=function(){return this.dataOfTower},e.prototype.inShootRange=function(t){return this.wPos.sub(t).mag()<=this.shootRange},e.prototype.forecastMovePos=function(t,e){var o=e.sub(this.wPOfShoot).mag()/this.speedOfBullet,i=t.getPosInTime(o+this.playTOfShoot);return this.inShootRange(i)?[i.x,i.y,o]:null},e.prototype.update=function(t){if(!this.isShoot)for(var e=0;e<this.monsterArray.length;e++){var o=this.monsterArray[e],i=o.node.parent.convertToWorldSpaceAR(o.node.getPosition());if(this.inShootRange(i)){if(o.swiOfRecursionInPW){var r=this.forecastMovePos(o,i);if(null===r)continue;this.shoot(cc.v2(r[0],r[1]),r[2]);break}this.shoot(o.getWPos());break}}},r([l({type:[cc.Vec2],tooltip:"\u5404\u7b49\u7ea7\u7684\u6cd5\u5e08\u7684Y\u5750\u6807"})],e.prototype,"offsetY",void 0),r([l({type:[u],tooltip:"\u5b83\u7684\u5e27\u56fe\u7247"})],e.prototype,"framesArray",void 0),r([l({type:[u],tooltip:"\u6cd5\u5e08\u7684\u5e27\u56fe\u7247"})],e.prototype,"magiclanFrames",void 0),r([l({type:cc.Prefab})],e.prototype,"bulletPrefab",void 0),r([l({type:cc.Node,displayName:"\u5c04\u51fb\u70b9"})],e.prototype,"PosOfShoot",void 0),e=r([c],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../common/module/gameDataManager":"gameDataManager","../../monster/monster":"monster"}],monsterFactory:[function(t,e,o){"use strict";cc._RF.push(e,"fe408t71SRIeYSayhsudyzg","monsterFactory");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("./monster"),s=t("../../common/animationPath"),a=cc._decorator,c=a.ccclass,l=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.monsterPrefab=[],e.animationPath=null,e.creMonList=[],e.cT=0,e.poolOfMonster=null,e.roadNum=null,e}return i(e,t),e.prototype.onLoad=function(){this.poolOfMonster=[];for(var t=0;t<this.monsterPrefab.length;t++)this.poolOfMonster[t]=new cc.NodePool;n.default.monstersOfAlive=[]},e.prototype.init=function(t){this.creMonList=[],this.cT=0,this.roadNum=t},e.prototype.createMonster=function(t){this.creMonList.push(t)},e.prototype.clearMonsters=function(){for(;n.default.monstersOfAlive.length>0;){var t=n.default.monstersOfAlive[0];t.die(n.default.monstersOfAlive,t),t.releaseSelf()}},e.prototype.destroyMonster=function(t){this.poolOfMonster[t.monsterNo].put(t.node)},e.prototype._createMonster=function(t){var e;this.poolOfMonster[t].size()>0?(e=this.poolOfMonster[t].get()).opacity=255:e=cc.instantiate(this.monsterPrefab[t]);var o=e.getComponent("monster");this.node.addChild(e),n.default.monstersOfAlive.push(o),o.init(t,this.animationPath.getWorldPath("road"+this.getRandomNumber(1,this.roadNum).toString()))},e.prototype.getRandomNumber=function(t,e){return t+Math.floor(Math.random()*(e-t+1))},e.prototype.update=function(t){this.creMonList.length>0&&(this.cT+=t,this.cT>1&&(this.cT=0,this._createMonster(this.creMonList.shift())))},r([l({type:[cc.Prefab]})],e.prototype,"monsterPrefab",void 0),r([l({type:s.default})],e.prototype,"animationPath",void 0),e=r([c],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../../common/animationPath":"animationPath","./monster":"monster"}],monster:[function(t,e,o){"use strict";cc._RF.push(e,"88ea4NumMZGd5gFC7814wew","monster");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n,s=t("../creature"),a=t("../combatLogic"),c=t("../tower/barrack/soldier"),l=t("../../common/module/gameDataManager"),u=t("../../common/module/utils"),p=t("../../common/move"),h=cc._decorator,f=h.ccclass,d=h.property;(function(t){t[t.Down=0]="Down",t[t.left=1]="left",t[t.up=2]="up",t[t.right=3]="right"})(n||(n={}));var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.attackFrame=[],e.deadFrame=[],e.downWalkFrames=[],e.rightWalkFrames=[],e.upWalkFrames=[],e.monsterFactory=null,e.levelScene=null,e.monsterNo=null,e.monsterData=null,e.path=null,e.pathTime=[],e.pathIndex=0,e.swiOfRecursionInPW=!1,e.moveInPath=!0,e.stateOfFA=null,e}var o;return i(e,t),o=e,e.prototype.onLoad=function(){this.combatLogic=new a.default(this,c.default.soldiersOfAlive),this.monsterFactory=cc.find("Canvas/personMap").getComponent("monsterFactory"),this.levelScene=cc.find("Canvas").getComponent("levelScene"),this._move=new p.default(this.node);var t=l.default.getGameConfig();this.monsterData=t.getMonsterData()},e.prototype.init=function(t,e){this.monsterNo=t;var o=this.monsterData[t];this.maxHp=this.cHP=o.HP,this.speedOfMove=o.speedOfMove,this.intervalOfAttack=o.intervalOfAttack,this.aggressivity=o.aggressivity,this.rangeOfAttack=o.rangeOfAttack,this.rangeOfInvestigate=o.rangeOfInvestigate,this.intervalOfThink=o.intervalOfThink,this.path=e,this.initPathTime(),this.frameAnim.setSpriteFrame(this.downWalkFrames[0]),this.refreshBloodBar(),this.node.setPosition(this.node.parent.convertToNodeSpaceAR(this.path[0])),this.pathIndex=1,this.swiOfRecursionInPW=!1,this.moveInPath=!0,this.stateOfFA=null,this.initCreature()},e.prototype.getPosInTime=function(t){var e=this.pathIndex,o=this.getWPos(),i=this.path[e].sub(o).mag()/this.speedOfMove;for(t-=i;!((t-=i=this.pathTime[e+1])<0);)e++;return this.path[e]},e.prototype.initPathTime=function(){for(var t=0;t<this.path.length-1;t++){var e=this.path[t+1].sub(this.path[t]).mag();this.pathTime[t]=e/this.speedOfMove}},e.prototype.walk=function(t,e,o){void 0===e&&(e=null),void 0===o&&(o=null);var i=t.sub(this.getWPos());this.playWalk(i),this.move(t,e,o)},e.prototype.stopWalk=function(){this.frameAnim.stop(),this.stateOfFA=null,this._move.stopMove()},e.prototype.playWalk=function(t){var e=this.getWalkState(t);if(e!==this.stateOfFA){switch(this.stateOfFA=e,e){case n.Down:this.frameAnim.setFrameArray(this.downWalkFrames);break;case n.up:this.frameAnim.setFrameArray(this.upWalkFrames);break;case n.left:this.frameAnim.setFrameArray(this.rightWalkFrames),this.node.scaleX=-1;break;case n.right:this.frameAnim.setFrameArray(this.rightWalkFrames),this.node.scaleX=1}this.frameAnim.play(!0)}},e.prototype.getWalkState=function(t){var e=this.getDegree(t);return e>=30&&e<=150?n.up:e>=210&&e<=330?n.Down:t.x>0?n.right:n.left},e.prototype.getDegree=function(t){var e;if(0===t.x&&t.y>0)e=90;else if(0===t.x&&t.y<0)e=270;else{e=180*Math.atan(t.y/t.x)/Math.PI}return 0===e?e=t.x>0?0:180:t.x<0&&t.y>0||t.x<0&&t.y<0?e+=180:t.x>0&&t.y<0&&(e+=360),e},e.prototype.refreshState=function(){this.refreshBloodBar(),0===this.cHP&&(this.die(o.monstersOfAlive,this),this.playDie(this.deadFrame,this.releaseSelf.bind(this)),this.levelScene.addCash(this.monsterData[this.monsterNo].price))},e.prototype.releaseSelf=function(){this.monsterFactory.destroyMonster(this)},e.prototype.walkInPath=function(){this.swiOfRecursionInPW&&(this.moveInPath?this.walk(this.path[this.pathIndex],this.walkCallBack.bind(this),this.pathTime[this.pathIndex-1]):(this.pathIndex=this.getPosOfMinDisWithPath(),this.walk(this.path[this.pathIndex],this.walkCallBack.bind(this)),this.moveInPath=!0))},e.prototype.walkCallBack=function(){this.pathIndex===this.path.length-1&&(console.log("\u602a\u7269\u8df3\u8131"),this.levelScene.subHP(),this.stopWalkInPath(),this.die(o.monstersOfAlive,this),this.releaseSelf()),this.pathIndex++,this.walkInPath()},e.prototype.getPosOfMinDisWithPath=function(){for(var t=this.getWPos(),e=u.default.getDisOfTwoPos(t,this.path[this.pathIndex]),o=this.pathIndex,i=this.pathIndex+1;i<this.path.length;i++){var r=u.default.getDisOfTwoPos(t,this.path[i]);if(!(r<e))break;e=r,o=i}return o},e.prototype.stopWalkInPath=function(){this.swiOfRecursionInPW=!1,this.moveInPath=!1,this.stopWalk()},e.prototype.track=function(t){this.isTracking=!0,this.walk(t,function(){this.isTracking=!0,this.stopWalk()}.bind(this))},e.prototype.stopTrack=function(){this.isTracking=!1,this.stopWalk()},e.prototype.refreshTrackTarget=function(t){this.walk(t,function(){this.isTracking=!0,this.stopWalk()}.bind(this))},e.prototype.attack=function(t){this.isAttacking=!0,this.frameAnim.setFrameArray(this.attackFrame),this.frameAnim.play(!1,!1,!1,function(){t.injure(this.aggressivity),this.isAttacking=!1}.bind(this))},e.prototype.nonComLogic=function(){this.isNonComState=!0,this.swiOfRecursionInPW||(this.swiOfRecursionInPW=!0,this.walkInPath())},e.prototype.stopNonComLogic=function(){this.stopWalkInPath(),this.isNonComState=!1},e.monstersOfAlive=null,r([d({type:[cc.SpriteFrame],tooltip:"\u602a\u7269\u653b\u51fb\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"attackFrame",void 0),r([d({type:[cc.SpriteFrame],tooltip:"\u602a\u7269\u6b7b\u4ea1\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"deadFrame",void 0),r([d({type:[cc.SpriteFrame]})],e.prototype,"downWalkFrames",void 0),r([d({type:[cc.SpriteFrame]})],e.prototype,"rightWalkFrames",void 0),r([d({type:[cc.SpriteFrame]})],e.prototype,"upWalkFrames",void 0),e=o=r([f],e)}(s.default);o.default=m,cc._RF.pop()},{"../../common/module/gameDataManager":"gameDataManager","../../common/module/utils":"utils","../../common/move":"move","../combatLogic":"combatLogic","../creature":"creature","../tower/barrack/soldier":"soldier"}],move:[function(t,e,o){"use strict";cc._RF.push(e,"cf0d9uX6CRLtInmWoub+LXl","move"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(t){this.host=null,this.distance=null,this.duration=null,this.callBack=null,this.ct=0,this.startMove=!1,this.host=t}return t.prototype.moveTo=function(t,e,o){void 0===o&&(o=null),this.distance=t,this.duration=e,this.callBack=o,this.ct=0,this.startMove=!0},t.prototype.stopMove=function(){this.startMove=!1},t.prototype.refreshMove=function(t){if(this.startMove){if(this.ct>=this.duration)return this.stopMove(),void(null!==this.callBack&&this.callBack());var e=t/this.duration,o=cc.v2(this.distance.x*e,this.distance.y*e),i=this.host.getPosition().add(o);this.host.setPosition(i),this.ct+=t}},t}();o.default=i,cc._RF.pop()},{}],nodeSort:[function(t,e,o){"use strict";cc._RF.push(e,"6138fxs+4VFYrG5yshoOB2G","nodeSort");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,a=(n.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cT=0,e.cL=1,e}return i(e,t),e.prototype.onLoad=function(){this.children=this.node.children},e.prototype.start=function(){},e.prototype.update=function(t){if(void 0!==this.children&&(this.cT+=t,this.cT>=this.cL)){this.cT=0,this.children.sort(function(t,e){return t.y>e.y?-1:1});for(var e=0;e<this.children.length;e++)this.children[e].zIndex=1e3+e}},e=r([s],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],selectLevelScene:[function(t,e,o){"use strict";cc._RF.push(e,"bd0b4IXk5lL3ZIxqlT2W5kU","selectLevelScene");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/gameDataManager"),s=t("./levelManager"),a=t("../../res/prefabs/loadingDoorAnim/loadingDoorAnim"),c=t("../common/module/soundsManager"),l=cc._decorator,u=l.ccclass,p=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingDoorAnim=null,e.scoreLabel=null,e.levelManager=null,e.skillsBoardAnimation=null,e.user=null,e.isBackButton=!1,e.gameConfig=null,e}return i(e,t),e.prototype.onLoad=function(){this.gameConfig=n.default.getGameConfig()},e.prototype.start=function(){this.user=n.default.getCurrentUser(),this.loadingDoorAnim.setState(!1),this.loadingDoorAnim.openDoor(),c.default.ins.curBGM="sounds/selectLevelsceneBGM",c.default.ins.playBGM(c.default.ins.curBGM),this.updateScoreLabel(),this.levelManager.updateLevelMap(this.user)},e.prototype.updateScoreLabel=function(){var t=this.gameConfig.getStarSum(),e=this.user.getCurrentHaveStarNum();this.scoreLabel.string=e.toString()+"/"+t.toString()},e.prototype.backButton=function(){if(!this.isBackButton){this.isBackButton=!0,c.default.ins.playEffect("sounds/click");var t=cc.callFunc(function(){cc.director.loadScene("homeScene",function(){var t=cc.find("Canvas/centerAnchor/loadingDoorAnim").getComponent("loadingDoorAnim");t.setState(!1),t.openDoor()})},this);this.loadingDoorAnim.closeDoor(t),n.default.preserveGameData()}},e.prototype.toLevelScene=function(t){var e=cc.callFunc(function(){cc.director.loadScene("levelScene",function(){cc.find("Canvas/loadingDoorAnim").getComponent("loadingDoorAnim").setState(!1),cc.find("Canvas").getComponent("levelScene").levelNum=Number(t)})},this);this.loadingDoorAnim.closeDoor(e),n.default.preserveGameData()},e.prototype.upgradeButton=function(){this.skillsBoardAnimation.play("skillsBoardDown")},r([p({type:a.default})],e.prototype,"loadingDoorAnim",void 0),r([p({type:cc.Label})],e.prototype,"scoreLabel",void 0),r([p({type:s.default})],e.prototype,"levelManager",void 0),r([p({type:cc.Animation})],e.prototype,"skillsBoardAnimation",void 0),e=r([u],e)}(cc.Component);o.default=h,cc._RF.pop()},{"../../res/prefabs/loadingDoorAnim/loadingDoorAnim":"loadingDoorAnim","../common/module/gameDataManager":"gameDataManager","../common/module/soundsManager":"soundsManager","./levelManager":"levelManager"}],settlementFace:[function(t,e,o){"use strict";cc._RF.push(e,"601cciYBP1PXJgBEnFR6ZHv","settlementFace");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/starReview"),s=cc._decorator,a=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.failFace=null,e.passFace=null,e.starReview=null,e}return i(e,t),e.prototype.start=function(){},e.prototype.outFailFace=function(){this.outFace(this.failFace)},e.prototype.hiddenFailFace=function(){this.hiddenFace(this.failFace)},e.prototype.outPassFace=function(t){this.starReview.setReview(t),this.outFace(this.passFace)},e.prototype.hiddenPassFace=function(){this.hiddenFace(this.passFace)},e.prototype.hiddenSettleFace=function(){this.failFace.active&&this.hiddenFailFace(),this.passFace.active&&this.hiddenPassFace()},e.prototype.outFace=function(t){t.active=!0,t.runAction(cc.fadeIn(.2)),this.scheduleOnce(function(){cc.director.pause()},.2)},e.prototype.hiddenFace=function(t){cc.director.resume(),t.runAction(cc.fadeOut(.2)),this.scheduleOnce(function(){t.active=!1}.bind(this),.2)},r([c({type:cc.Node})],e.prototype,"failFace",void 0),r([c({type:cc.Node})],e.prototype,"passFace",void 0),r([c({type:n.default})],e.prototype,"starReview",void 0),e=r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../common/starReview":"starReview"}],skillsBoard:[function(t,e,o){"use strict";cc._RF.push(e,"6a93fPowX9BkZmjApAudjYI","skillsBoard");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/gameDataManager"),s=t("./aSeriesSkill"),a=cc._decorator,c=a.ccclass,l=a.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.starNum=null,e.aSeriesSkillArray=[],e.user=null,e.selectLevelScene=null,e.animation=null,e}return i(e,t),e.prototype.onLoad=function(){this.user=n.default.getCurrentUser(),this.selectLevelScene=cc.find("Canvas").getComponent("selectLevelScene"),this.animation=this.node.getComponent(cc.Animation)},e.prototype.start=function(){this.updateStarNum(),this.updateAllSkills()},e.prototype.updateStarNum=function(){this.starNum.string=this.user.getCurrentHaveStarNum().toString()},e.prototype.skillBoardBack=function(){this.animation.play("skillsBoardUp")},e.prototype.updateAllSkills=function(){for(var t=0,e=this.aSeriesSkillArray;t<e.length;t++)e[t].updateSkillIcons()},e.prototype.resetSkills=function(){this.user.resetSkill(),this.updateStarNum(),this.selectLevelScene.updateScoreLabel(),this.updateAllSkills()},r([l({type:cc.Label})],e.prototype,"starNum",void 0),r([l({type:s.default,tooltip:"5\u4e2a\u6280\u80fd"})],e.prototype,"aSeriesSkillArray",void 0),e=r([c],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../common/module/gameDataManager":"gameDataManager","./aSeriesSkill":"aSeriesSkill"}],soldier:[function(t,e,o){"use strict";cc._RF.push(e,"723bapX0cVMWLHqO6N7iHb6","soldier");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../../creature"),s=t("../../../common/module/gameDataManager"),a=t("../../combatLogic"),c=t("../../monster/monster"),l=t("../../../common/move"),u=cc._decorator,p=u.ccclass,h=u.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.soldier1Attack=[],e.soldier1Dead=[],e.soldier1Walk=[],e.soldier2Attack=[],e.soldier2Dead=[],e.soldier2Walk=[],e.soldier3Attack=[],e.soldier3Dead=[],e.soldier3Walk=[],e.soldier4Attack=[],e.soldier4Dead=[],e.soldier4Walk=[],e.level=null,e.framesOfAnim=null,e.station=null,e.stationNo=null,e.soldierData=null,e.barrack=null,e.isToStation=!1,e.isPlayingWalk=!1,e.attackEnable=!0,e}var o;return i(e,t),o=e,e.prototype.onLoad=function(){this.framesOfAnim=[[this.soldier1Attack,this.soldier1Dead,this.soldier1Walk],[this.soldier2Attack,this.soldier2Dead,this.soldier2Walk],[this.soldier3Attack,this.soldier3Dead,this.soldier3Walk],[this.soldier4Attack,this.soldier4Dead,this.soldier4Walk]];var t=s.default.getGameConfig();this.soldierData=t.getSoldierData(),this.combatLogic=new a.default(this,c.default.monstersOfAlive),this._move=new l.default(this.node)},e.prototype.init=function(t,e,o,i){this.level=o;var r=this.soldierData[this.level];this.maxHp=this.cHP=r.HP,this.speedOfMove=r.speedOfMove,this.intervalOfAttack=r.intervalOfAttack,this.aggressivity=r.aggressivity,this.rangeOfAttack=r.rangeOfAttack,this.rangeOfInvestigate=r.rangeOfInvestigate,this.intervalOfThink=r.intervalOfThink,this.stationNo=t,this.station=e,this.frameAnim.setSpriteFrame(this.framesOfAnim[o][2][0]),this.refreshBloodBar(),this.barrack=i,this.isPlayingWalk=!1,this.isToStation=!1,this.attackEnable=!0,this.initCreature()},e.prototype.walk=function(t,e){void 0===e&&(e=null),this.updateDir(t),this.isPlayingWalk||(this.frameAnim.setFrameArray(this.framesOfAnim[this.level][2]),this.frameAnim.play(!0),this.isPlayingWalk=!0),this.move(t,function(){this.frameAnim.stop(),this.isPlayingWalk=!1,null!==e&&e()}.bind(this))},e.prototype.stopWalk=function(){this.frameAnim.stop(),this.isPlayingWalk=!1,this._move.stopMove()},e.prototype.refreshState=function(){this.refreshBloodBar(),0===this.cHP&&(this.die(o.soldiersOfAlive,this),this.playDie(this.framesOfAnim[this.level][1],this.releaseSelf.bind(this)))},e.prototype.releaseSelf=function(){this.barrack.releaseSoldier(this)},e.prototype.toStation=function(){this.isToStation=!0,this.walk(this.station,function(){this.isToStation=!1}.bind(this))},e.prototype.inStation=function(){return this.getWPos().sub(this.station).mag()<2},e.prototype.track=function(t){this.isTracking=!0,this.walk(t,function(){this.isTracking=!1}.bind(this))},e.prototype.stopTrack=function(){this.stopWalk(),this.isTracking=!1},e.prototype.refreshTrackTarget=function(t){this.walk(t,function(){this.isTracking=!1}.bind(this))},e.prototype.attack=function(t){this.isAttacking||this.attackEnable&&(this.attackEnable=!1,this.scheduleOnce(function(){this.attackEnable=!0}.bind(this),1),this.isAttacking=!0,this.frameAnim.setFrameArray(this.framesOfAnim[this.level][0]),this.frameAnim.play(!1,!1,!1,function(){t.injure(this.aggressivity),this.isAttacking=!1}.bind(this)))},e.prototype.nonComLogic=function(){this.isNonComState=!0,this.inStation()||this.isToStation||this.toStation()},e.prototype.stopNonComLogic=function(){this.isNonComState=!1,this.isToStation&&(this.stopWalk(),this.isToStation=!1)},e.soldiersOfAlive=null,r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea71\u7684\u58eb\u5175\u653b\u51fb\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier1Attack",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea71\u7684\u58eb\u5175\u6b7b\u4ea1\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier1Dead",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea71\u7684\u58eb\u5175\u884c\u8d70\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier1Walk",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea72\u7684\u58eb\u5175\u653b\u51fb\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier2Attack",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea72\u7684\u58eb\u5175\u6b7b\u4ea1\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier2Dead",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea72\u7684\u58eb\u5175\u884c\u8d70\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier2Walk",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea73\u7684\u58eb\u5175\u653b\u51fb\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier3Attack",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea73\u7684\u58eb\u5175\u6b7b\u4ea1\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier3Dead",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea73\u7684\u58eb\u5175\u884c\u8d70\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier3Walk",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea74\u7684\u58eb\u5175\u653b\u51fb\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier4Attack",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea74\u7684\u58eb\u5175\u6b7b\u4ea1\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier4Dead",void 0),r([h({type:[cc.SpriteFrame],tooltip:"\u7b49\u7ea74\u7684\u58eb\u5175\u884c\u8d70\u5e27\u52a8\u753b\u56fe\u7247"})],e.prototype,"soldier4Walk",void 0),e=o=r([p],e)}(n.default);o.default=f,cc._RF.pop()},{"../../../common/module/gameDataManager":"gameDataManager","../../../common/move":"move","../../combatLogic":"combatLogic","../../creature":"creature","../../monster/monster":"monster"}],soundsManager:[function(t,e,o){"use strict";cc._RF.push(e,"8469a2dt0JLx5rqIeUclwoq","soundsManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./storageManager"),r=function(){function t(){this.isBGMMute=!1,this.isEffectMute=!1,this.curBGM=null,this.isBGMMute=i.default.ins.getData("isBGMMute"),null===this.isBGMMute&&(this.isBGMMute=!1),this.isEffectMute=i.default.ins.getData("isEffectMute"),null===this.isEffectMute&&(this.isEffectMute=!1)}return t.init=function(){this.ins=new t},Object.defineProperty(t.prototype,"IsBGMMute",{get:function(){return this.isBGMMute},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IsEffectMute",{get:function(){return this.isEffectMute},enumerable:!0,configurable:!0}),t.prototype.openBGM=function(){this.isBGMMute&&(this.isBGMMute=!1,i.default.ins.storageData("isBGMMute",!1),this.curBGM&&this.playBGM(this.curBGM))},t.prototype.closeBGM=function(){this.isBGMMute||(this.isBGMMute=!0,i.default.ins.storageData("isBGMMute",!0),cc.audioEngine.pauseMusic())},t.prototype.openEffect=function(){this.isEffectMute&&(this.isEffectMute=!1,i.default.ins.storageData("isEffectMute",!1))},t.prototype.closeEffect=function(){this.isEffectMute||(this.isEffectMute=!0,i.default.ins.storageData("isEffectMute",!0),cc.audioEngine.stopAllEffects())},t.prototype.playBGM=function(t){this.isBGMMute||cc.loader.loadRes(t,cc.AudioClip,function(t,e){cc.audioEngine.playMusic(e,!0)}.bind(this))},t.prototype.playEffect=function(t){this.isEffectMute||cc.loader.loadRes(t,cc.AudioClip,function(t,e){cc.audioEngine.playEffect(e,!1)})},t.ins=null,t}();o.default=r,cc._RF.pop()},{"./storageManager":"storageManager"}],starReview:[function(t,e,o){"use strict";cc._RF.push(e,"17a5bpiCUROtoTufMZ9GBwd","starReview");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,s=n.ccclass,a=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.stars=[],e}return i(e,t),e.prototype.setReview=function(t){for(var e=0;e<t;e++)this.stars[e].active=!0},r([a({type:[cc.Node]})],e.prototype,"stars",void 0),e=r([s],e)}(cc.Component);o.default=c,cc._RF.pop()},{}],startAnim:[function(t,e,o){"use strict";cc._RF.push(e,"d84c7vw3itCJZgQAZ79g8CH","startAnim");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/soundsManager"),s=cc._decorator,a=s.ccclass,c=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animation=null,e.isButtonDown=!1,e.clips=null,e}return i(e,t),e.prototype.onLoad=function(){this.animation=this.node.getComponent(cc.Animation),this.clips=this.animation.getClips()},e.prototype.start=function(){},e.prototype.logoDown=function(){this.animation.play("homeSceneStart")},e.prototype.buttonUp=function(){this.animation.play("buttonUp")},e.prototype.buttonDown=function(){if(!this.isButtonDown){this.isButtonDown=!0,n.default.ins.playEffect("sounds/click"),this.animation.play("buttonDown");var t=cc.delayTime(this.clips[2].duration),e=cc.callFunc(function(){this.isButtonDown=!1},this),o=cc.sequence(t,e);this.node.runAction(o)}},e=r([a],e)}(cc.Component));o.default=c,cc._RF.pop()},{"../common/module/soundsManager":"soundsManager"}],storageManager:[function(t,e,o){"use strict";cc._RF.push(e,"5b356Jms5BGTa+3XY/EELA9","storageManager"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){this.ls=cc.sys.localStorage}return t.init=function(){this.ins=new t},t.prototype.storageData=function(t,e){this.ls.setItem(t,e)},t.prototype.getData=function(t){return this.ls.getItem(t)},t.prototype.removeData=function(t){this.ls.removeItem(t)},t.ins=null,t}();o.default=i,cc._RF.pop()},{}],storeBoard:[function(t,e,o){"use strict";cc._RF.push(e,"b4e39Usi6RNBY7exBtleB5L","storeBoard");var i=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),r=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,s=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(n<3?r(s):n>3?r(e,o,s):r(e,o))||s);return n>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=t("../common/module/gameDataManager"),s=cc._decorator,a=s.ccclass,c=s.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.storeNode=[],e.inputBox=null,e.inputLabel=null,e.gameConfig=null,e.users=null,e.clickStoreButton=!1,e.homeScene=null,e}return i(e,t),e.prototype.onLoad=function(){this.homeScene=cc.find("Canvas").getComponent("homeScene")},e.prototype.start=function(){this.users=n.default.getUsers(),this.gameConfig=n.default.getGameConfig(),this.updateStoreBoard()},e.prototype.updateStoreBoard=function(){for(var t=0;t<3;t++)void 0===this.users[t]?this.updateStore(this.storeNode[t],null):this.updateStore(this.storeNode[t],this.users[t])},e.prototype.updateStore=function(t,e){var o=t.getChildByName("nameLabel").getComponent(cc.Label),i=t.getChildByName("startNum").getComponent(cc.Label);if(null===e)return o.string="\u65e0",void(i.string="0/"+this.gameConfig.getStarSum());o.string=e.getUsername(),i.string=e.getStarSum()+"/"+this.gameConfig.getStarSum()},e.prototype.storeButton=function(t,e){if(!this.clickStoreButton){this.clickStoreButton=!0;var o=parseInt(e);if(this.users.length<o)return this.inputBox.active=!0,void(this.clickStoreButton=!1);this.homeScene.selectLevelScene(o-1)}},e.prototype.inputDetermine=function(){this.inputBox.active=!1,""!==this.inputLabel.string&&(n.default.createUser(this.inputLabel.string),this.updateStoreBoard())},e.prototype.cancelButton=function(){this.inputBox.active=!1},e.prototype.deleteStore=function(t,e){var o=parseInt(e);if(!(this.users.length<o)){var i=this.users[o-1].getUsername();n.default.delUser(i),this.updateStoreBoard(),console.log("\u5220\u9664\u5b58\u6863",i)}},r([c({type:cc.Node})],e.prototype,"storeNode",void 0),r([c({type:cc.Node})],e.prototype,"inputBox",void 0),r([c({type:cc.Label})],e.prototype,"inputLabel",void 0),e=r([a],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../common/module/gameDataManager":"gameDataManager"}],utils:[function(t,e,o){"use strict";cc._RF.push(e,"c81achqaJRGE79sgbdiAK1F","utils"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.getRandomInterger=function(t,e){return t+Math.floor(Math.random()*(e-t+1))},t.remvoeItemOfArray=function(t,e){var o=t.indexOf(e);t.splice(o,1)},t.getDisOfTwoPos=function(t,e){return t.sub(e).mag()},t}();o.default=i,cc._RF.pop()},{}]},{},["loadingDoorAnim","audioSwitch","aboutScene","animationPath","frameAnimation","gameDataManager","levelDataManager","soundsManager","storageManager","utils","move","nodeSort","starReview","homeScene","startAnim","storeBoard","V_gameState","builder","combatLogic","creature","levelScene","monster","monsterFactory","settlementFace","arrowBullet","arrowTower","arrower","artilleryBullet","artilleryTower","barrack","soldier","magiclanBullet","magiclanTower","aSeriesSkill","levelManager","selectLevelScene","skillsBoard"]);